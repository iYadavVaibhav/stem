


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Data Engineering, Data Science, Business Analytics, Data Visualization, Business Intelligence">
      
      
        <meta name="author" content="Vaibhav Yadav - Data Engineer, Scientist and Analyst">
      
      
        <link rel="canonical" href="https://iYadavVaibhav.github.io/stem/0-Information-Technology/flask/">
      
      
        <link rel="prev" href="../docker/">
      
      
        <link rel="next" href="../flutter/">
      
      
      <link rel="icon" href="../../assets/images/apple-touch-icon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Flask - Vaibhav Yadav's Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#flask" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Vaibhav Yadav&#39;s Wiki" class="md-header__button md-logo" aria-label="Vaibhav Yadav's Wiki" data-md-component="logo">
      
  <img src="../../assets/images/apple-touch-icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vaibhav Yadav's Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Flask
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/iYadavVaibhav/stem" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    iyadavvaibhav/stem
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Vaibhav Yadav&#39;s Wiki" class="md-nav__button md-logo" aria-label="Vaibhav Yadav's Wiki" data-md-component="logo">
      
  <img src="../../assets/images/apple-touch-icon.png" alt="logo">

    </a>
    Vaibhav Yadav's Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/iYadavVaibhav/stem" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    iyadavvaibhav/stem
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home iYV
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    0 Information Technology
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            0 Information Technology
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aws-amazon-web-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Amazon Web Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bokeh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bokeh
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootstrap-ui/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bootstrap UI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dockerize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Flask
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Flask
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flask-hello-world" class="md-nav__link">
    <span class="md-ellipsis">
      Flask Hello World
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-a-flask-app-ways" class="md-nav__link">
    <span class="md-ellipsis">
      Run a Flask App - Ways
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flask-native-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Flask native modules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jinja-templates-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Templates in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jinja Templates in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macro-and-includes" class="md-nav__link">
    <span class="md-ellipsis">
      Macro and Includes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snippets" class="md-nav__link">
    <span class="md-ellipsis">
      Snippets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generators" class="md-nav__link">
    <span class="md-ellipsis">
      Generators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handlers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flask-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Flask Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flask Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrap-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrap in Flask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moment-js-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Moment JS in Flask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forms-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Forms in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Forms in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-a-form" class="md-nav__link">
    <span class="md-ellipsis">
      Build a Form
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-save-form-data" class="md-nav__link">
    <span class="md-ellipsis">
      Get Save Form Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Databases in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Databases in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-tablesmodels" class="md-nav__link">
    <span class="md-ellipsis">
      Define Tables/Models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Create Tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relationships-in-database" class="md-nav__link">
    <span class="md-ellipsis">
      Relationships in Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-or-create" class="md-nav__link">
    <span class="md-ellipsis">
      Insert or Create
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-or-select-or-query" class="md-nav__link">
    <span class="md-ellipsis">
      Read or Select or Query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      Update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Delete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql" class="md-nav__link">
    <span class="md-ellipsis">
      RAW SQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-database-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple Database Connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrations-in-database" class="md-nav__link">
    <span class="md-ellipsis">
      Migrations in Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-in-flask-flask-login" class="md-nav__link">
    <span class="md-ellipsis">
      Login in Flask - Flask Login
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login in Flask - Flask Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#role-based-control" class="md-nav__link">
    <span class="md-ellipsis">
      Role based control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emails-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Emails in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blueprint-large-app-structure-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Blueprint - Large App Structure in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Testing in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Writing Tests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#log-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Log in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      CLI in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jupyter-notebook-with-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Jupyter Notebook with Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-flaws-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Security Flaws Checks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-the-project-installable" class="md-nav__link">
    <span class="md-ellipsis">
      Make the Project Installable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Fundamentals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-windows-iis-server" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment - Windows IIS Server
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-pythonanywhere-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment - PythonAnywhere Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-site-with-flask-frozen" class="md-nav__link">
    <span class="md-ellipsis">
      Static Site with Flask-Frozen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-localhost-flask-app-on-network" class="md-nav__link">
    <span class="md-ellipsis">
      Access localhost flask app on Network
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#machine-learning-pandas-app-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Machine Learning Pandas App in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charts-graphs-visualization-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Charts Graphs Visualization in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restapi-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      RestAPI in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RestAPI in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      API Architecture
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt-authentication-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Authentication in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flask-snippets" class="md-nav__link">
    <span class="md-ellipsis">
      Flask Snippets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-restful-api-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      App - RESTful API in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serving-over-https" class="md-nav__link">
    <span class="md-ellipsis">
      Serving over HTTPS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-social-blogging-app-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      App - Social Blogging App in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-mega-tutorial-by-mg" class="md-nav__link">
    <span class="md-ellipsis">
      App - Mega Tutorial by MG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elastic-search-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Elastic Search in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    <span class="md-ellipsis">
      Links
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flutter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flutter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../gen-ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generative Artificial Intelligence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-cloud-platform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Google Cloud Platform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../htmx-flask/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTMX and use with Flask
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../javascript-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JavaScript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../material-mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Material for MkDocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nativescript-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NativeScript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pelican/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pelican
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../plotly-dash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plotly and Dash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pwa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PWA with Flask
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../r-language/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    R and R-Studio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../react-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    React JS Notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../text-editors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text Editors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools-frameworks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tools and Frameworks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../virtual-box/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Virtual Box
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../web-server-config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Server Config
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1 Software Engineering
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            1 Software Engineering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/cs-se-basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSE Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/data-structures-algorithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Structures and Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/design-principle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Design Principles and Patterns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/domain-driven-development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain Driven Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git and GitHub
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/js-ecma6-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ECMA 6+
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/linux-terminal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Terminal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/oops-python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OOPs in Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/regex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security, IAM, RBAC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/software-diagrams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Diagrams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../1-Software-Engineering/web-development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Development
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2 Data Engineering
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            2 Data Engineering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/apache-airflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache Airflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/apache-iceberg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache Iceberg Notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/apache-kafka/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache Kafka
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/apache-spark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apache Spark
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/big-data/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Big Data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/data-engineering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Engineering Roadmap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/data-frameworks-tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Tools &amp; Frameworks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/data-python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL Operations in Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/data-science/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Science
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/data-solutions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Solutions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/data-testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/data-warehousing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/databases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databases &amp; SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databricks Notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/etl_pipelines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ETL Pipelines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/pandas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pandas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/python-data-wrangling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python Data Wrangling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2-Data-Engineering/tableau/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tableau
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    3 Management & Strategy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            3 Management & Strategy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-Management-%26-Strategy/ajile-sprint-scrum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agile, Scrum and Sprints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../3-Management-%26-Strategy/project-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Management
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    4 Functional & Business
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            4 Functional & Business
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-Functional-%26-Business/banking-finance-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Banking and Finance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../4-Functional-%26-Business/business-analytics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Business Analytics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    5 Personal Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            5 Personal Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-Personal-Development/interview-career-growth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Career Growth Interview Mindset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../5-Personal-Development/pd-courses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Personal Development Courses
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    6 Math & Logic
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            6 Math & Logic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-Math-%26-Logic/logarithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logarithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../6-Math-%26-Logic/probability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Probability
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    7 Other
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            7 Other
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../7-Other/electronics-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Electronics &amp; IoT
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    8 Blog & Articles
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            8 Blog & Articles
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../8-Blog-%26-Articles/fake-data-using-faker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Create fake data using Faker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../8-Blog-%26-Articles/github-pages-jekyll/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jekyll on Github
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../8-Blog-%26-Articles/hello-humans/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello Humans
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../8-Blog-%26-Articles/syntax-highlight-jekyll/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jekyll Syntax Highlight
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    9 Drafts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            9 Drafts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/dea-c01-u0-exam-course-intro-ps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS DEA-C01 Preparation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/dea-c01-u1-data-ingestion-and-transformation-ps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    U1 Data Ingestion and Transformation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/dea-c01-u2-data-store-management-ps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    U2 Data Store Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/dea-c01-u3-data-operations-and-support-ps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    U3 Data Operations and Support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/dea-c01-u4-data-security-and-governance-ps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    U4 Data Security and Governance
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/ll-py-design-patterns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python: Design Patterns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/ll-software-architecture-domain-driven-design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Architecture: Domain-Driven Design
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/mblog-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    App - mBlog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/mongodb-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mongo DB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../9-Drafts/notepad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notepad
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flask-hello-world" class="md-nav__link">
    <span class="md-ellipsis">
      Flask Hello World
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-a-flask-app-ways" class="md-nav__link">
    <span class="md-ellipsis">
      Run a Flask App - Ways
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flask-native-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Flask native modules
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jinja-templates-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja Templates in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jinja Templates in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macro-and-includes" class="md-nav__link">
    <span class="md-ellipsis">
      Macro and Includes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snippets" class="md-nav__link">
    <span class="md-ellipsis">
      Snippets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generators" class="md-nav__link">
    <span class="md-ellipsis">
      Generators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handlers
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flask-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Flask Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flask Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootstrap-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Bootstrap in Flask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moment-js-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Moment JS in Flask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#forms-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Forms in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Forms in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-a-form" class="md-nav__link">
    <span class="md-ellipsis">
      Build a Form
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-save-form-data" class="md-nav__link">
    <span class="md-ellipsis">
      Get Save Form Data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Databases in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Databases in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-tablesmodels" class="md-nav__link">
    <span class="md-ellipsis">
      Define Tables/Models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Create Tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#relationships-in-database" class="md-nav__link">
    <span class="md-ellipsis">
      Relationships in Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-or-create" class="md-nav__link">
    <span class="md-ellipsis">
      Insert or Create
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read-or-select-or-query" class="md-nav__link">
    <span class="md-ellipsis">
      Read or Select or Query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      Update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Delete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#raw-sql" class="md-nav__link">
    <span class="md-ellipsis">
      RAW SQL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-database-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple Database Connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrations-in-database" class="md-nav__link">
    <span class="md-ellipsis">
      Migrations in Database
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#login-in-flask-flask-login" class="md-nav__link">
    <span class="md-ellipsis">
      Login in Flask - Flask Login
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Login in Flask - Flask Login">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#role-based-control" class="md-nav__link">
    <span class="md-ellipsis">
      Role based control
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emails-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Emails in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blueprint-large-app-structure-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Blueprint - Large App Structure in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Testing in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Manual Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#writing-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Writing Tests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#log-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Log in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      CLI in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jupyter-notebook-with-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Jupyter Notebook with Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-flaws-checks" class="md-nav__link">
    <span class="md-ellipsis">
      Security Flaws Checks
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-the-project-installable" class="md-nav__link">
    <span class="md-ellipsis">
      Make the Project Installable
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Fundamentals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-windows-iis-server" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment - Windows IIS Server
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-pythonanywhere-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment - PythonAnywhere Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#static-site-with-flask-frozen" class="md-nav__link">
    <span class="md-ellipsis">
      Static Site with Flask-Frozen
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-localhost-flask-app-on-network" class="md-nav__link">
    <span class="md-ellipsis">
      Access localhost flask app on Network
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#machine-learning-pandas-app-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Machine Learning Pandas App in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#charts-graphs-visualization-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Charts Graphs Visualization in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restapi-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      RestAPI in Flask
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RestAPI in Flask">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      API Architecture
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jwt-authentication-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      JWT Authentication in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flask-snippets" class="md-nav__link">
    <span class="md-ellipsis">
      Flask Snippets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-restful-api-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      App - RESTful API in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serving-over-https" class="md-nav__link">
    <span class="md-ellipsis">
      Serving over HTTPS
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-social-blogging-app-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      App - Social Blogging App in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app-mega-tutorial-by-mg" class="md-nav__link">
    <span class="md-ellipsis">
      App - Mega Tutorial by MG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elastic-search-in-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Elastic Search in Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-flask" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Flask
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#links" class="md-nav__link">
    <span class="md-ellipsis">
      Links
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                

    
                  

  
    <a href="https://github.com/iYadavVaibhav/stem/edit/master/docs/0-Information-Technology/flask.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/iYadavVaibhav/stem/raw/master/docs/0-Information-Technology/flask.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="flask">Flask</h1>
<p>Flask is a microframework in Python. It is used to create a webapp. It can start a python web server. It can handle HTTP requests. It can also be used to make a webapp API.</p>
<h2 id="flask-hello-world">Flask Hello World</h2>
<ul>
<li>
<p>Create a python file <code>main.py</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="ch">#!venv_app/bin/python3</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="k">return</span> <span class="s2">&quot;Hello from Flask App!&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>run using <code>python main.py</code></li>
</ul>
<ul>
<li>access at <code>http://localhost:5000</code> in browser.</li>
</ul>
<h2 id="run-a-flask-app-ways">Run a Flask App - Ways</h2>
<ul>
<li>python<ul>
<li><code>python main.py</code></li>
</ul>
</li>
</ul>
<ul>
<li>executable<ul>
<li><code>chmod a+x main.py</code> to make app executable.</li>
<li><code>./main.py</code> runs app.</li>
</ul>
</li>
</ul>
<ul>
<li>Flask CLI<ul>
<li><code>flask --app main.py run</code>
  or</li>
<li><code>export FLASK_APP=main.py</code> will make an variable that tells python which app to run.</li>
<li><code>flask run</code> executes the app or if flask is not in path then do <code>python -m flask run</code></li>
<li>flask --app has app command</li>
<li>flask run has --host or -h, --port or -p and --no-debug</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nb">set</span><span class="w"> </span><span class="nv">FLASK_ENV</span><span class="o">=</span>production
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">set</span><span class="w"> </span><span class="nv">FLASK_DEBUG</span><span class="o">=</span><span class="m">0</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nb">cd</span><span class="w"> </span>repo<span class="se">\p</span>rj1
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>flask<span class="w"> </span>--app<span class="w"> </span>app:create_app<span class="o">(</span><span class="s1">&#39;uat&#39;</span><span class="o">)</span><span class="w"> </span>run<span class="w"> </span>--no-debug<span class="w"> </span>-h<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span>-p<span class="w"> </span><span class="m">5002</span>
</code></pre></div>
<h2 id="flask-native-modules">Flask native modules</h2>
<p><em>flask basics, request-response handling, contexts</em></p>
<ul>
<li><strong>Application Instance</strong><ul>
<li><code>Flask()</code> - is a class.</li>
<li>All Flask applications must create an <strong>application instance</strong> (object of class <code>Flask</code>). The web server passes all requests it receives from clients to this object for handling, using a protocol called Web Server Gateway Interface (WSGI).</li>
<li><code>app = Flask(__name__)</code> name is passed to <code>Flask</code> class constructor so it knows the location of app and hence can locate static and template.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Requests</strong><ul>
<li>Request from client has lot of information in it, like header, user-agent, data etc. This information is available in <code>request object</code> and is made available to a <code>view-route function</code> to handle it. This object is not passed as an argument to function, rather it is made available using <code>contexts</code>.</li>
<li><code>request</code> Object has methods and attributes having info on method, form, args, cookies, files, remote_addr, get_data().</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Contexts</strong><ul>
<li>Code is logic with data. Data is variables or constants or objects. This data can be configurations, input data or data from file/database. In flask, "Context" is used to keep track of this data.</li>
<li>It let certain objects to be globally accessible, but are not global variable. They are globally accessible to only one thread. There can be multiple threads serving multiple requests from multiple client.</li>
<li>Context is simply data that is specific to something. Eg<ul>
<li><strong>App-context</strong> is specific to app, like its mail server, its database location, or other configurations. Keeps track of application-level data. Objects: <code>current_app</code>, <code>g</code>.</li>
<li><strong>Request-context</strong> is specific to request, like its browser, its client, its form data, its headers, all that is request-level. Objects: <code>request</code>, <code>session</code>.</li>
</ul>
</li>
<li>this data is stored in object, in attribute such as <code>config</code></li>
<li>this data is used by extensions in flask, hence they do not run if context is not available.</li>
<li>context is automatically made available once app is initialized.</li>
<li>context can be made explicitly available by calling <code>with app.app_context():</code></li>
</ul>
</li>
</ul>
<ul>
<li><strong>Request Handling</strong> - How flask handles a request?<ul>
<li>
<p>when there is request, web server activates a thread that initializes app and this app context is pushed with data that is available globally, similarly request context is also pushed.</p>
<pre class="mermaid"><code>graph LR;
Web_Browser --&gt; request --&gt; web_server --&gt; Flask_app_instance --&gt; route --&gt; function_to_execute</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Flask variables for Request Handling</strong><ul class="task-list">
<li><code>current_app</code> variable in Application context, has info of active application.</li>
<li><strong>Imp</strong>: <code>current_app</code> is app-context, but is <strong>only available when serving a request</strong>, that is, in a route function only. It can be used in any module but the function should be called when serving a request.</li>
<li><code>g</code> variable in Application context, it is object that is unique for each request, temp access <strong>during</strong> handling of a request. It resets once request is served. Holds app info hence app context. Can be used to load user on each request. show logged in user on templates.</li>
<li><code>request</code>, in request context, obj having client req data.</li>
<li><code>session</code>, in request context, stores data across requests, i.e., a dictionary to store values that can be accessed in different requests from same session.</li>
<li>Flask, in backend, makes these available to thread before dispatching a request and removes after request is handled. Explicitly, <code>current_app</code> can be made available by invoking <code>app.app_context()</code></li>
<li class="task-list-item"><input type="checkbox"/> How does flask differentiate requests and clients?</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Request Hooks</strong><ul>
<li>They are deocrators that register functions that can execute code before or after each request is processed. They are implemented as decorators  (functions that execute on event). These are the four hooks supported by Flask:</li>
<li><code>before_request</code> - like authenticate</li>
<li><code>before_first_request</code> - only before the first request is handled. Eg, to add server initialization tasks.</li>
<li><code>after_request</code> - after each request, but only if no unhandled exceptions occurred.</li>
<li><code>teardown_request</code> - after each request, even if unhandled exceptions occurred.</li>
<li><code>g</code> context global storage can be used to share data between hook and view functions.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Routes or View Functions</strong><ul>
<li>They handle application URLs.</li>
<li>URL-maps can be seen using <code>app.url_map</code></li>
<li>redirect to url<ul>
<li><code>redirect</code> - takes URL to redirect to.</li>
<li><code>redirect(url_for("profile"))</code></li>
<li><code>url_for()</code> utility builds URL for view-function giving route from app-url-map. takes function name as str and gives its URL. Eg:<ul>
<li><code>url_for('user', name='john', page=2, version=1)</code> would return <code>/user/john?page=2&amp;version=1</code>, they are good to build dynamic URLs that can be used in templates.</li>
<li><code>url_for('user', name='john', _external=True)</code> would return <code>http://localhost:5000/user/john</code>.</li>
<li><code>url_for('static', filename='css/styles.css', _external=True)</code> would return <code>http://localhost:5000/static/css/styles.css</code>.</li>
<li><code>/static/&lt;filename&gt;</code> is special route added by Flask to serve static files.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>Response Object</strong></p>
<ul>
<li>
<p>Response is returned by view-function as a string (usually HTML) along with <strong>status code</strong> but can also contain <strong>headers</strong>. So rather than sending comma separated tuple values, flask lets create response object using <code>make_response()</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">make_response</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;Some response with a cookie!&lt;/h1&gt;&#39;</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="s1">&#39;51&#39;</span><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="k">return</span> <span class="n">response</span>
</code></pre></div>
</li>
</ul>
<ul>
<li><code>return redirect('http://www.example.com')</code> is a response with URL and status code 302, however Flask lets it do easily using <code>redirect()</code> method. Another such is <code>abort(404)</code> which is treated as exception.</li>
</ul>
<ul>
<li><strong>session</strong> - can be used to store values, specific to current session, it is server side. Helps to pass values from one function to another.<ul>
<li><code>session["username"] = username</code></li>
<li>permanent sessions store session data for a time period</li>
</ul>
</li>
</ul>
<ul>
<li><strong>flash</strong> - lets send extra messages to frontend<ul>
<li><code>flash("The message", "info")</code> message and level.</li>
<li><code>get_flashed_messages()</code> to get messages</li>
<li>it lets record a message at the end of a request and access it next request and only next request.<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>{% for message in get_flashed_messages() %}
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;flash&quot;</span><span class="p">&gt;</span>{{ message }}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>{% endfor %}
</code></pre></div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="jinja-templates-in-flask">Jinja Templates in Flask</h2>
<p>Templates can be used to build responses.</p>
<ul>
<li><strong>render_template()</strong><ul>
<li>it makes use of template</li>
<li><code>return render_template('user.html', name=name)</code></li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>Jinja Templates</strong></p>
<ul>
<li>Templates are HTML file having additional Python like code in <strong>placeholders</strong>.</li>
<li>Placeholders can have <strong>variables</strong> and <strong>expressions</strong>.</li>
<li>They get replaced with value when template is rendered by <strong>JinJa2</strong>, the template engine.</li>
<li>This lets build dynamic content on execution.</li>
<li>It lets <strong>inherit</strong>, <strong>extend</strong> and <strong>import</strong> templates.</li>
<li>More documentation on <a href="https://jinja.palletsprojects.com/en/latest/templates/">template design</a> and <a href="https://jinja.palletsprojects.com/en/latest/tricks/">tips and tricks</a></li>
<li>
<p>Example template is below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My Webpage<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;navigation&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    {% for item in navigation %}
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ item.href }}&quot;</span><span class="p">&gt;</span>{{ item.caption }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    {% endfor %}
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>    {% if kenny.sick %}
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>      Kenny is sick.
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    {% elif kenny.dead %}
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>      You killed Kenny!  You bastard!!!
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    {% else %}
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>      Kenny looks okay --- so far
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    {% endif %}
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>My Webpage<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>    {{ a_variable }}
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>    {# a comment #}
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
</li>
</ul>
<ul>
<li><strong>Filters</strong><ul>
<li>pass value over pipe to filter functions like upper, lower, title, trim, safe.</li>
<li>eg, <code>Hello, {{ name|capitalize }}</code></li>
<li>Full list of filters <a href="https://jinja.palletsprojects.com/en/latest/templates/#list-of-builtin-filters">here</a></li>
</ul>
</li>
</ul>
<ul>
<li><strong>Delimiters</strong><ul>
<li>{% ... %} for Statements</li>
<li>{{ ... }} for Expressions to print</li>
<li>{# ... #} for Comments, not included in the template output.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Assignments</strong><ul>
<li>
<p>lets set a value to var and use it for logic building. We have to use namespace.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>{% set ns = namespace(index=0) %}
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>{% for nav_item in nav %} 
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>  {% if ns.index !=0 %}
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    --- some stuff ---
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>  {% endif %}
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>  {% set ns.index = ns.index + 1 %}
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>{% endfor %}
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>{{ super() }}, includes code from parent block, if overriding a block.</li>
</ul>
</li>
</ul>
<h3 id="macro-and-includes">Macro and Includes</h3>
<p>When you have one code to include at few place use <code>include</code>, eg, sidebar, nav, footer.</p>
<p>When you have a code to use at many places use <code>macro</code>, eg, form elements, nav items, alerts.</p>
<p>"When you have a chunk of code that you think should be present in a different template just for better organization and it won't need to take any parameters, for example the header, footer, complex navigation menu, etc. then include is good for this case. But when you have something that will be repeated multiple times and might need some dynamic parameters, for e.g. form fields, then you should use macro for it."</p>
<p><code>+-</code> in <code>{%</code> are only for HTML whitespace, they do not have logical meaning.</p>
<p><strong>Define Macro</strong></p>
<p>A <code>some.html</code> file can have multiple macro blocks. Eg, in <code>macros/items.html</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>{% macro role_icon_for(user) -%}
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>  {% if user.role == &#39;admin&#39; %}
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fa fa-3x fa-fw fa-shield&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Admin&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>  {% else %}
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="p">&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fa fa-3x fa-fw fa-user text-muted&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;Member&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">i</span><span class="p">&gt;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>  {% endif %}
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>{% endmacro %}
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>{# Render a checkbox field. #}
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>{%- macro checkbox_field(f) -%}
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>  {{ f(type=&#39;checkbox&#39;, **kwargs) }} {{ f.label }}
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>{%- endmacro -%}
</code></pre></div>
<p><strong>Using Macro</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>{% import &#39;macros/items.html&#39; as items %}
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>...
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>{{ items.role_icon_for(user) }}
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>...
</code></pre></div>
<p><strong>Call Macro from another Macro</strong></p>
<p>It is like blocks in jinja. A caller-macro can call another macro. They both can include each other code.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>{# being called #}
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>{%- macro form_tag(endpoint, fid=&#39;&#39;, css_class=&#39;&#39;, method=&#39;post&#39;) -%}
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;{{ url_for(endpoint, **kwargs) }}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;{{ method }}&quot;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>        <span class="na">id</span><span class="o">=</span><span class="s">&quot;{{ fid }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;{{ css_class }}&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;form&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    {{ form.hidden_tag() }}
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    {{ caller () }}         {# code of caller will be in here #}
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>{%- endmacro -%}
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>{# the caller #}
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>{%- macro search_form(endpoint) -%}
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>  {% call form_tag(endpoint, method=&#39;get&#39;) %}
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;q&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;input-group&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>      <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;q&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;q&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>  {% endcall %}
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>{%- endmacro -%}
</code></pre></div>
<p>Here, Caller-macro can also push code to called-macro which shows using <code>{{ caller () }}</code>.</p>
<p><strong>Include</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>{% include &#39;admin/_menu.html&#39; %}
</code></pre></div>
<p>Link: <a href="https://stackoverflow.com/a/22287698/1055028">SO - macro vs includes</a></p>
<h3 id="snippets">Snippets</h3>
<p><strong>Show All ORM data as Table</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>  {% if (flows is defined) and flows %}
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>  <span class="p">&lt;</span><span class="nt">table</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;flows_table&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table table-striped&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>      {% set flow_h = flows[0] %}
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>      {% for attr, value in flow_h.__dict__.items() %}
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>        {% if attr not in (&#39;_sa_instance_state&#39;) %}
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>{{attr | replace(&quot;_&quot;,&quot; &quot;) | title }}<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        {% endif%}
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>      {% endfor %}
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>      {% for flow in flows %}
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>          {% for attr, value in flow.__dict__.items() %}
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>            {% if attr not in (&#39;_sa_instance_state&#39;) %}
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>              <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ value }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>            {% endif %}
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>          {% endfor %}
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>      {% endfor %}
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>    <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>  <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a>  {% endif %}
</code></pre></div>
<p><strong>Show All ORM Data in Card as Key: Value pair with skipping a few</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>{{user.user_name | title}}<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>User Posts<span class="p">&lt;/</span><span class="nt">h5</span><span class="p">&gt;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row row-cols-2 g-2&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>{% if (posts is defined) and posts %}
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>  {% for post in user.posts %}
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    {# each post #}
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;col&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;card-body&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>          {% for attr, value in post.__dict__.items() %}
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>            {% if attr not in (&#39;_sa_instance_state&#39;, &#39;user_id&#39;) and (value) %}
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>              <span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;mb-1&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;text-muted&quot;</span><span class="p">&gt;</span>{{attr | replace(&quot;_&quot;,&quot; &quot;) | title }}: <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>                <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>                  {% if value is float %}
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>                    {{&quot;%.2f&quot;|format(value)}}
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>                  {% else %}
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>                    {{ value }}
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>                  {% endif %}
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>                <span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>              <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>            {% endif %}
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>          {% endfor %}
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a>        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a>      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a>  {% endfor %}
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a>{% else %}
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="p">&lt;</span><span class="nt">p</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;lead&quot;</span><span class="p">&gt;</span>No records found!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a>{% endif %}
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</code></pre></div>
<p>In above snippet, <code>and (value)</code> will only show those values that are not <code>None</code>.</p>
<p><strong>Pandas to HTML using JSON</strong></p>
<p>You can convert a df to json, more on <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_json.html">doc</a>, eg:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>&gt;&gt;&gt;<span class="w"> </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>df.to_json<span class="o">(</span><span class="nv">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="o">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>&gt;&gt;&gt;<span class="w"> </span><span class="nv">parsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>loads<span class="o">(</span>result<span class="o">)</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>&gt;&gt;&gt;<span class="w"> </span>dumps<span class="o">(</span>parsed,<span class="w"> </span><span class="nv">indent</span><span class="o">=</span><span class="m">4</span><span class="o">)</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="o">[</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">        </span><span class="s2">&quot;col 1&quot;</span>:<span class="w"> </span><span class="s2">&quot;a&quot;</span>,
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">        </span><span class="s2">&quot;col 2&quot;</span>:<span class="w"> </span><span class="s2">&quot;b&quot;</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="o">}</span>,
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">    </span><span class="o">{</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">        </span><span class="s2">&quot;col 1&quot;</span>:<span class="w"> </span><span class="s2">&quot;c&quot;</span>,
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">        </span><span class="s2">&quot;col 2&quot;</span>:<span class="w"> </span><span class="s2">&quot;d&quot;</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">    </span><span class="o">}</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="o">]</span>
</code></pre></div>
<p>In <code>view.py</code> file</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">loads</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">df</span> <span class="o">=</span> <span class="c1"># your code</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">df_json</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">df_1</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">df_json</span><span class="p">)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;show.html&quot;</span><span class="p">,</span> <span class="n">df_1</span><span class="o">=</span><span class="n">df_1</span><span class="p">)</span>
</code></pre></div>
<p>In <code>show.html</code> template, generate table with this, then you may copy and hardcode column and modify values with actions, etc.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>  <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>      {% for col in df_1[1].keys() %}
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>{{col}}<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>      {% endfor %}
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>  <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>  <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>    {% for row in df_1 %}
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>      {% for k,v in row.items() %}
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>        <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{v}}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>      {% endfor %}
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>    {% endfor %}
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>  <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="generators">Generators</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># required json format</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">df_json</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># Generates jinja code to show json df as table</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">def</span> <span class="nf">generate_jijna_json2table</span><span class="p">(</span><span class="n">parsed</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;df&quot;</span><span class="p">):</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="n">ths</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># table heads</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    <span class="n">tds</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="c1"># table rows</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">parsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>        <span class="n">ths</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;th&gt;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&lt;/th&gt;&quot;</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>        <span class="n">tds</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;td&gt;{{row.get(&#39;&quot;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s2">&quot;&#39;)}}&lt;/td&gt;&quot;</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>    <span class="n">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="s2">    &lt;table class=&quot;table table-hover mb-4&quot; id=&quot;a_datatable&quot;&gt;</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="s2">    &lt;thead&gt;</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="s2">        &lt;tr&gt;</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="s2">            &quot;&quot;&quot;</span><span class="o">+</span><span class="n">ths</span><span class="o">+</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="s2">        &lt;/tr&gt;</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="s2">    &lt;/thead&gt;</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="s2">    &lt;tbody&gt;</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="s2">        {</span><span class="si">% f</span><span class="s2">or row in &quot;&quot;&quot;</span><span class="o">+</span><span class="n">var_name</span><span class="o">+</span><span class="s2">&quot;&quot;&quot; %}</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="s2">        &lt;tr&gt;</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="s2">        &quot;&quot;&quot;</span><span class="o">+</span><span class="n">tds</span><span class="o">+</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="s2">        &lt;/tr&gt;</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="s2">        {</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="s2">    &lt;/tbody&gt;</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="s2">    &lt;/table&gt;</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>    <span class="k">return</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</code></pre></div>
<p>You can print what is returned from above function and paste it in jinja for further modification.</p>
<h3 id="error-handlers">Error Handlers</h3>
<p><code>@app.errorhandler</code> is decorator that lets return a view from template for error responses like 404 and 500.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">def</span> <span class="nf">page_not_found</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;404.html&#39;</span><span class="p">),</span> <span class="mi">404</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="k">def</span> <span class="nf">internal_server_error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;500.html&#39;</span><span class="p">),</span> <span class="mi">500</span>
</code></pre></div>
<h2 id="flask-extensions">Flask Extensions</h2>
<p>Most extensions use app context to initialize themselves, eg:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kn">from</span> <span class="nn">flask_bootstrap</span> <span class="kn">import</span> <span class="n">Bootstrap</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="n">bootstrap</span> <span class="o">=</span> <span class="n">Bootstrap</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div>
<h3 id="bootstrap-in-flask">Bootstrap in Flask</h3>
<ul>
<li>
<p><strong>Bootstrap</strong> - provides templates and blocks that can be used in Jinja2 Templates</p>
<ul>
<li>installation <code>pip install flask-bootstrap</code></li>
<li>eg, <code>{% extends "bootstrap/base.html" %}</code> - base.html does not exist but is available via extension. Others are <code>navbar</code>, <code>content</code>, <code>script</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>{% block scripts %}
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>{{ super() }} <span class="cm">&lt;!--includes base scripts too, else overrides--&gt;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;my-script.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>{% endblock %}
</code></pre></div>
</li>
</ul>
<h3 id="moment-js-in-flask">Moment JS in Flask</h3>
<ul>
<li><strong>Moment.js Flask-Moment</strong> - Localization of Dates and Times<ul>
<li>server should send UTC, client should present in local time and formatted to region using JavaScript.</li>
<li><code>Moment.js</code> is perfect for this and is available as flask extension. It can be used in Jinja2 template.</li>
<li><code>pip install flask-moment</code></li>
<li>
<p>include the script, <code>jQuery</code> is already attached as part of bootstrap</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>{% block scripts %}
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>  {{ super() }}
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>  {{ moment.include_moment() }}
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>{% endblock %}
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">from</span> <span class="nn">flask_moment</span> <span class="kn">import</span> <span class="n">Moment</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">moment</span> <span class="o">=</span> <span class="n">Moment</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="k">return</span> <span class="n">moment</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;LLL&#39;</span><span class="p">)</span> <span class="c1"># local time</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="k">return</span> <span class="n">moment</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span><span class="o">.</span><span class="n">fromNow</span><span class="p">(</span><span class="n">refresh</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># a few seconds ago..</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<h2 id="forms-in-flask">Forms in Flask</h2>
<p><strong>WTForms</strong> - <strong>Object Oriented</strong> Form building. It supports forms validation, CSRF protection, internationalization (I18N), showing errors, extending forms, rendering form, file upload, reCAPTCHA and more for any Python framework, its generic. <a href="http://wtforms.simplecodes.com/">WTForms</a>.</p>
<p>It also works well with other extensions like Flask-Bootstrap and Flask-SQLAlchemy to do common tasks in one line.</p>
<p><strong>Installation</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>Flask-WTF
</code></pre></div>
<p><strong>Instantiation</strong></p>
<p>Global CSRF protection</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>from<span class="w"> </span>flask_wtf.csrf<span class="w"> </span>import<span class="w"> </span>CSRFProtect
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="nv">csrf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CSRFProtect<span class="o">()</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>def<span class="w"> </span>create_app<span class="o">()</span>:
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">    </span>...
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">    </span>csrf.init_app<span class="o">(</span>app<span class="o">)</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">    </span>...
</code></pre></div>
<h3 id="build-a-form">Build a Form</h3>
<p>Make a class to build form, members are form fields. See <a href="https://flask-wtf.readthedocs.io/en/1.2.x/quickstart/">quick-start flask-wtf</a>. Form Class can be build in main <code>app.py</code> or in module <code>forms.py</code> with fields and validate functions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kn">from</span> <span class="nn">flask_wtf</span> <span class="kn">import</span> <span class="n">FlaskForm</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">SubmitField</span><span class="p">,</span> <span class="n">SelectField</span><span class="p">,</span> <span class="n">DateField</span><span class="p">,</span> <span class="n">BooleanField</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">DataRequired</span><span class="p">,</span> <span class="n">Length</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Regexp</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="kn">from</span> <span class="nn">wtforms.widgets</span> <span class="kn">import</span> <span class="n">DateTimeLocalInput</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="k">class</span> <span class="nc">RegistrationForm</span><span class="p">(</span><span class="n">FlaskForm</span><span class="p">):</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>    <span class="n">username</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Username&#39;</span><span class="p">,</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>                           <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">DataRequired</span><span class="p">(),</span> <span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">25</span><span class="p">)])</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>    <span class="n">username</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s1">&#39;Username&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">max</span><span class="o">=</span><span class="mi">40</span><span class="p">)])</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>    <span class="n">level</span>    <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="s1">&#39;User Level&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">NumberRange</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">)])</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>    <span class="n">birthday</span>  <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="s1">&#39;Your Birthday&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%y&#39;</span><span class="p">)</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>    <span class="n">signature</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span><span class="s1">&#39;Forum Signature&#39;</span><span class="p">)</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>    <span class="n">accept_rules</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="s1">&#39;I accept the site rules&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="o">.</span><span class="n">InputRequired</span><span class="p">()])</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>    <span class="n">registered_number</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>        <span class="s2">&quot;Registered Number&quot;</span><span class="p">,</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>        <span class="n">validators</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>            <span class="n">Optional</span><span class="p">(),</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>            <span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>            <span class="n">Regexp</span><span class="p">(</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>                <span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^[\d]{1,16}$&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Registered Number must contain numbers only&quot;</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>            <span class="p">)</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>        <span class="p">],</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>        <span class="n">render_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;placeholder&quot;</span><span class="p">:</span> <span class="s2">&quot;Registered Number&quot;</span><span class="p">}</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>    <span class="p">)</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>    <span class="c1"># Select</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>    <span class="n">period</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span><span class="s1">&#39;Period&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">DataRequired</span><span class="p">()],</span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>                        <span class="n">choices</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;Apple&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;Ball&#39;</span><span class="p">)],</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>                        <span class="n">prepend_blank</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>    <span class="c1"># Select from Database</span>
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>    <span class="n">gym_choices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">gym</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">gym</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">gym</span> <span class="ow">in</span> <span class="n">Gym</span><span class="o">.</span><span class="n">get_gyms</span><span class="p">()]</span>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>
<a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a>    <span class="n">gym_id</span> <span class="o">=</span> <span class="n">SelectField</span><span class="p">(</span><span class="s1">&#39;Select Gym&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">gym_choices</span><span class="p">)</span>
<a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a>
<a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a>
<a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a>    <span class="c1"># Date</span>
<a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>    <span class="n">start_date</span> <span class="o">=</span> <span class="n">DateField</span><span class="p">(</span><span class="s1">&#39;Start Date&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a>
<a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a>    <span class="n">in_at</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="s1">&#39;In Date-Time&#39;</span><span class="p">,</span>
<a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a>                      <span class="n">validators</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a>                          <span class="n">DataRequired</span><span class="p">()</span>
<a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a>                          <span class="p">],</span>
<a id="__codelineno-23-54" name="__codelineno-23-54" href="#__codelineno-23-54"></a>                      <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M&quot;</span><span class="p">,</span>
<a id="__codelineno-23-55" name="__codelineno-23-55" href="#__codelineno-23-55"></a>                      <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">,</span>
<a id="__codelineno-23-56" name="__codelineno-23-56" href="#__codelineno-23-56"></a>                      <span class="n">widget</span><span class="o">=</span><span class="n">DateTimeLocalInput</span><span class="p">()</span>
<a id="__codelineno-23-57" name="__codelineno-23-57" href="#__codelineno-23-57"></a>                      <span class="p">)</span>
<a id="__codelineno-23-58" name="__codelineno-23-58" href="#__codelineno-23-58"></a>
<a id="__codelineno-23-59" name="__codelineno-23-59" href="#__codelineno-23-59"></a>    <span class="c1"># Submit</span>
<a id="__codelineno-23-60" name="__codelineno-23-60" href="#__codelineno-23-60"></a>    <span class="n">submit</span> <span class="o">=</span> <span class="n">SubmitField</span><span class="p">(</span><span class="s1">&#39;Submit&#39;</span><span class="p">)</span>
<a id="__codelineno-23-61" name="__codelineno-23-61" href="#__codelineno-23-61"></a>
<a id="__codelineno-23-62" name="__codelineno-23-62" href="#__codelineno-23-62"></a>    <span class="k">def</span> <span class="nf">validate_in_at</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
<a id="__codelineno-23-63" name="__codelineno-23-63" href="#__codelineno-23-63"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;max 10 minutes from now can be in time&quot;&quot;&quot;</span>
<a id="__codelineno-23-64" name="__codelineno-23-64" href="#__codelineno-23-64"></a>      <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-23-65" name="__codelineno-23-65" href="#__codelineno-23-65"></a>          <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;Your in time cannot be in future!&#39;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Data Types Fields</strong> in <code>wtforms</code> that can be used to build form fields. <a href="https://wtforms.readthedocs.io/en/3.0.x/fields/#basic-fields">more on wtforms fields</a></p>
<table>
<thead>
<tr>
<th>DataType</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>StringField</td>
<td>One line string</td>
</tr>
<tr>
<td>BooleanField</td>
<td>check box</td>
</tr>
<tr>
<td>DateField</td>
<td>date only</td>
</tr>
<tr>
<td>DateTimeField</td>
<td>date and time</td>
</tr>
<tr>
<td>DecimalField</td>
<td>decimal numbers</td>
</tr>
<tr>
<td>IntegerField</td>
<td>whole numbers</td>
</tr>
<tr>
<td>SelectField</td>
<td>dropdown picklist</td>
</tr>
<tr>
<td>RadioField</td>
<td>radio buttons</td>
</tr>
<tr>
<td>SubmitField</td>
<td>submit button</td>
</tr>
<tr>
<td>HiddenField</td>
<td>not visible</td>
</tr>
<tr>
<td>EmailField</td>
<td>Email type</td>
</tr>
<tr>
<td>PasswordField</td>
<td>Password type dots</td>
</tr>
<tr>
<td>TextAreaField</td>
<td>multi-line</td>
</tr>
</tbody>
</table>
<p><strong>Validators</strong> that can be used for each field. Each field accepts list of validators in <code>validators=</code> argument. <a href="https://wtforms.readthedocs.io/en/3.0.x/validators/#built-in-validators">More on wtform validations</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kn">from</span> <span class="nn">wtforms.validators</span> <span class="kn">import</span> <span class="n">DataRequired</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Validator</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>DataRequired()</td>
<td>Required Field</td>
</tr>
<tr>
<td>NumberRange(min=0, max=10)</td>
<td>For IntegerField</td>
</tr>
<tr>
<td>Optional()</td>
<td>Lets continue form submission, used with DateField</td>
</tr>
</tbody>
</table>
<p><strong>Custom Validation</strong> lets you define your own validation method.  In the form class one can define a method <code>validate_{fieldname}</code> that validates the corresponding field. This method takes as arguments <code>field</code> and <code>form</code> so I can refer to the startdate field as <code>form.startdate_field</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">class</span> <span class="nc">SignupForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>    <span class="n">age</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="s1">&#39;Age&#39;</span><span class="p">)</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>    <span class="n">startdate_field</span> <span class="o">=</span> <span class="n">DateField</span><span class="p">(</span><span class="s1">&#39;Start Date&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>    <span class="n">enddate_field</span> <span class="o">=</span> <span class="n">DateField</span><span class="p">(</span><span class="s1">&#39;End Date&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>    <span class="k">def</span> <span class="nf">validate_age</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">13</span><span class="p">:</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a>            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;We&#39;re sorry, you must be 13 or older to register&quot;</span><span class="p">)</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>    <span class="k">def</span> <span class="nf">validate_enddate_field</span><span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a>        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="n">form</span><span class="o">.</span><span class="n">startdate_field</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;End date must not be earlier than start date.&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>Widgets</strong></p>
<p>Widgets are Classes that bring a specific selector UI for input field. Eg, Date-Picker, Color-Picker etc. <a href="https://wtforms.readthedocs.io/en/3.0.x/widgets/?highlight=widget#widgets">WTForm Widgets</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#input_types">HTML5 Input Types</a> for more.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kn">from</span> <span class="nn">wtforms.widgets</span> <span class="kn">import</span> <span class="n">DateTimeLocalInput</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Widget</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>DateTimeLocalInput</td>
<td>Show datetime-local input type. Lets user input date and time.</td>
</tr>
</tbody>
</table>
<p>For extra <code>input</code> params, you can use render_kw argument to send.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">in_at</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="s1">&#39;In Date-Time&#39;</span><span class="p">,</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>                      <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M&quot;</span><span class="p">,</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>                      <span class="n">widget</span><span class="o">=</span><span class="n">DateTimeLocalInput</span><span class="p">(),</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>                      <span class="n">render_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="s2">&quot;300&quot;</span><span class="p">}</span> 
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>                     <span class="p">)</span>
</code></pre></div>
<h3 id="get-save-form-data">Get Save Form Data</h3>
<p>Once a user submits a form it is automatically validated, and then the data in form can be used in flask to create edit delete or do other stuff.</p>
<p>Validation happens when <code>validate_on_submit()</code> is called, and it is called on <code>POST</code> method only. You can <strong>explicitly</strong> call <code>form.validate()</code> which returns boolean and then handle processing.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># ADD</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;task/new&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="k">def</span> <span class="nf">new</span><span class="p">():</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>    <span class="n">form</span> <span class="o">=</span> <span class="n">TaskForm</span><span class="p">()</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>      <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">()</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>      <span class="n">form</span><span class="o">.</span><span class="n">populate_obj</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>         <span class="c1"># one line fill object, OR</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>      <span class="n">Task</span><span class="o">.</span><span class="n">in_at</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">in_at</span><span class="o">.</span><span class="n">data</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>      <span class="n">Task</span><span class="o">.</span><span class="n">note</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">data</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>      <span class="o">...</span>                             <span class="c1"># one line and one-by-one can be combined</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>      <span class="n">task</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>      <span class="n">task</span><span class="o">.</span><span class="n">added_via</span> <span class="o">=</span> <span class="s1">&#39;form&#39;</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>      <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Task added successfully!&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">)</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;task.all&#39;</span><span class="p">))</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="c1"># EDIT</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;task/&lt;int:id&gt;/edit&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>    <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>    <span class="n">form</span> <span class="o">=</span> <span class="n">TaskForm</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>     <span class="c1"># one line form fill</span>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>    <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>        <span class="n">form</span><span class="o">.</span><span class="n">populate_obj</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>   <span class="c1"># one line obj  fill</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a>        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a>        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;task.all&#39;</span><span class="p">))</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;task/form.html&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
<a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a>
<a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a><span class="c1"># DELETE</span>
<a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a><span class="nd">@checkin</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;task/&lt;int:id&gt;/delete&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a>    <span class="n">task</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="n">Task</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
<a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a>
<a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a>    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
<a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a>    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a>
<a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a>    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;task.all&#39;</span><span class="p">))</span>
</code></pre></div>
<p><strong>Rendering View</strong></p>
<p>You can use same view (html template) to add or edit resource. This template recieves <code>form</code> as object and it has all the members to show label, button, inputs etc.</p>
<p>Here is code to show form fileds one ny one</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="x">&lt;form method=&quot;POST&quot;&gt;</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="cp">{{</span> <span class="nv">form.hidden_tag</span><span class="o">()</span> <span class="cp">}}</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="cp">{{</span> <span class="nv">form.name.label</span> <span class="cp">}}</span><span class="x"> </span><span class="cp">{{</span> <span class="nv">form.name</span><span class="o">()</span> <span class="cp">}}</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="cp">{{</span> <span class="nv">form.submit</span><span class="o">()</span> <span class="cp">}}</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="x">&lt;/form&gt;</span>
</code></pre></div>
<p>Or, use <code>flask-bootstrap</code> with <code>flask-wtf</code> to magically display form with one-line</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="cp">{%</span> <span class="k">import</span> <span class="s2">&quot;bootstrap/wtf.html&quot;</span> <span class="k">as</span> <span class="nv">wtf</span> <span class="cp">%}</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="cp">{{</span> <span class="nv">wtf.quick_form</span><span class="o">(</span><span class="nv">form</span><span class="o">)</span> <span class="cp">}}</span><span class="x"> &lt;!-- one line --&gt;</span>
</code></pre></div>
<p><strong>Form POST Button</strong></p>
<p>Add delete button where you list resource, the code below will only add a button with a confirm check:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="x">&lt;form action=&quot;</span><span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;task.delete&#39;</span><span class="o">,</span> <span class="nv">id</span><span class="o">=</span><span class="nv">task.id</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot; method=&quot;POST&quot;&gt;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="x">    &lt;input type=&quot;hidden&quot; name=&quot;csrf_token&quot; value=&quot;</span><span class="cp">{{</span> <span class="nv">csrf_token</span><span class="o">()</span> <span class="cp">}}</span><span class="x">&quot;/&gt;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="x">    &lt;button type=&quot;submit&quot; class=&quot;btn btn-outline-danger&quot; </span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="x">      onclick=&quot;return confirm(&#39;Are you sure?&#39;)&quot; </span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="x">    &gt;</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="x">      Delete</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="x">    &lt;/button&gt;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="x">&lt;/form&gt;</span>
</code></pre></div>
<p><strong>Adding CSRF to whole app</strong></p>
<p>You may also need to add CSRF in app, in <code>app.py</code> or <code>__init__.py</code>, add</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kn">from</span> <span class="nn">flask_wtf.csrf</span> <span class="kn">import</span> <span class="n">CSRFProtect</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="o">...</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">csrf</span> <span class="o">=</span> <span class="n">CSRFProtect</span><span class="p">()</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="o">...</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="n">csrf</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div>
<hr />
<ul>
<li>
<p><strong>Flask-WTF</strong> integration of Flask and WTForms</p>
<ul>
<li>Includes CSRF, file upload, and reCAPTCHA. You mostly have to use formats of WTForms but write less as few things are done automatically that are related to Flask patter.</li>
<li>Form fields are Class variables with different field type</li>
<li>validator functions can help validate, like <code>Email()</code>.</li>
<li>Link to <a href="http://pythonhosted.org/Flask-WTF/">Flask-WTF</a></li>
</ul>
<ul>
<li>
<p><strong>Validation</strong> controller</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>  <span class="n">form</span> <span class="o">=</span> <span class="n">NameForm</span><span class="p">()</span> <span class="c1"># defined as OOP model</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>  <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">validate_on_submit</span><span class="p">():</span> <span class="c1"># cheks POST and validates</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">data</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span> <span class="c1"># POST -&gt; back to this function as GET</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a>  <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span> <span class="c1"># When GET</span>
</code></pre></div>
<ul>
<li>Route - define new route, import form class and use. On submit, create object of model class to save/query data.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="databases-in-flask">Databases in Flask</h2>
<p>DB_package or ORM - Python has packages for most database engines like MySQL, Postgres, SQLite, MongoDb etc. If not, you can use ORM that lets you use Python objects to do SQL operations, SQLAlchemy or MongoEngine are such packages.</p>
<p><a href="http://pythonhosted.org/Flask-SQLAlchemy/">Flask-SQLAlchemy</a> is wrapper on <a href="http://www.sqlalchemy.org/">SQLAlchemy</a>. You have to use SQLAlchemy pattern but it helps by making things tied to Flask way like session of SQLAlchemy is tied to web-request of flask.</p>
<ul>
<li>It is designed for Flask and adds support for SQLAlchemy to your application. So basically you use all knowledge and concept of SQLAlchemy but tied up with flask. Remember, SQL Alchemy can be used withour flask from command line or any other python program.</li>
<li>
<p>You can define table as a class, called model, with member variables as column names.
SQLAlchemy documentation is to be reffered, just add <code>db</code> before commands. so</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>       <span class="c1"># SQLAlchemy</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>    <span class="c1"># Flask-SQLAlchemy</span>
</code></pre></div>
</li>
</ul>
<p><strong>Installation</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>flask-sqlalchemy
</code></pre></div>
<p><strong>Initiation</strong></p>
<p>create <code>SQLAlchemy()</code> class object and pass <code>app</code> for context. In <code>app.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kn">from</span> <span class="nn">flask_sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQLALCHEMY_DATABASE_URI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sqlite:///&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basedir</span><span class="p">,</span> <span class="s1">&#39;data.sqlite&#39;</span><span class="p">)</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span> <span class="c1"># Object for all ops</span>
</code></pre></div>
<h3 id="define-tablesmodels">Define Tables/Models</h3>
<p>Conventions:</p>
<ul>
<li>in database, table name is plural - users, books etc</li>
<li>in python, model class name is singular - User, Book etc</li>
</ul>
<p>Tables can be defined in OOP pattern as a class called "model". Model is a Class which represents application entities, like, User, Task, Author, Book etc. You can define, table, its columns, data types, keys and relationships. The class has attributes that represent column name, eg <code>name = db.Column(db.String(64)</code>.</p>
<p>In <code>model.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users&#39;</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>    <span class="n">username</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>    <span class="n">admin</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">)</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>    <span class="n">created_on</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>    <span class="n">updated_at</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>                            <span class="n">onupdate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">())</span>
</code></pre></div>
<p>You can define column as following <strong>Data Types</strong>:</p>
<table>
<thead>
<tr>
<th>DataType</th>
<th>Detail</th>
</tr>
</thead>
<tbody>
<tr>
<td>Integer</td>
<td>an integer</td>
</tr>
<tr>
<td>String(size)</td>
<td>a string with a maximum length (optional in some databases, e.g. PostgreSQL)</td>
</tr>
<tr>
<td>Text</td>
<td>some longer unicode text</td>
</tr>
<tr>
<td>DateTime</td>
<td>date and time expressed as Python datetime object.</td>
</tr>
<tr>
<td>Float</td>
<td>stores floating point values</td>
</tr>
<tr>
<td>Boolean</td>
<td>stores a boolean value</td>
</tr>
</tbody>
</table>
<p>You can define <strong>properties</strong> like:</p>
<table>
<thead>
<tr>
<th>Prop</th>
<th>Value</th>
<th>Detail</th>
</tr>
</thead>
<tbody>
<tr>
<td>primary_key</td>
<td>True</td>
<td>makes primary key</td>
</tr>
<tr>
<td>unique</td>
<td>True</td>
<td>ensures unique</td>
</tr>
<tr>
<td>nullable</td>
<td>True/False</td>
<td>allows NULLs or not</td>
</tr>
<tr>
<td>default</td>
<td>any value of same data-type</td>
<td>provides default value that is inserted if value provided is NONE. The default value is provided in INSERT query.</td>
</tr>
<tr>
<td>onupdate</td>
<td>any value of same data-type</td>
<td>changes on row update</td>
</tr>
<tr>
<td>db.ForeignKey('some.id')</td>
<td>pass table_name.column_name</td>
<td>Adds relationship</td>
</tr>
<tr>
<td>server_default</td>
<td>any value of same data-type</td>
<td>It adds to DDL, create table statement, <a href="https://docs.sqlalchemy.org/en/20/core/defaults.html#server-invoked-ddl-explicit-default-expressions">more</a></td>
</tr>
</tbody>
</table>
<h3 id="create-tables">Create Tables</h3>
<p>Once you have created a db model in flask app, you can create db and tables using following steps, open python shell:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span> <span class="c1"># creates all tables from model class, if they don&#39;t exist</span>
</code></pre></div>
<p><strong>Advanced</strong>, if you are using application factory, then you need app_context to work with database object:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">create_app</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="n">app_context</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">()</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="n">app_context</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>
</code></pre></div>
<p>Now you can check SQL for tables created. You can do:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>sqlite3<span class="w"> </span>filename.db
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>.tables
</code></pre></div>
<p>If you have done any <em>changes</em> to the model, like adding a column, you need to again recreate tables, but command above doesn't recreate existing tabke, you need to drop them and recreate, in python shell</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">db</span><span class="o">.</span><span class="n">drop_all</span><span class="p">()</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>
</code></pre></div>
<p><a href="#migrations-in-database">Migrations</a> is a better way to do this without dropping created data and keeping version control to go back is, more on this later.</p>
<h3 id="relationships-in-database">Relationships in Database</h3>
<p>You can define relationship in OOPs way as attribute of class. Beauty is that the tables are linked both ways. In <code>model.py</code>.</p>
<p>Example of <strong>One to Many</strong> relationship. User has multiple posts but post has only one author. <code>User 1-m Post</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>    <span class="n">title</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>    <span class="n">body</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Text</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>    <span class="n">user_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>    <span class="c1"># relationships</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>    <span class="n">posts</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">,</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>                <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">),</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>                <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>                <span class="n">order_by</span><span class="o">=</span><span class="s2">&quot;desc(Post.created_at)&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Here you <strong>note</strong>, the <code>ForeignKey()</code> relation has to be defined in the table that has many records but <code>db.relationship(.. ,backref=)</code> can be in either of the two tables, so following statements are same:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1"># in Post table, this tells Post has 1 Author and that has MANY posts</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">author</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">))</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="c1"># OR in User table, this tells User has MANY Posts, and that has 1 author</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>    <span class="n">posts</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">))</span>
</code></pre></div>
<p>Here, <code>backref</code> adds a back-reference to other model. <code>lazy=False</code> tells SQLAlchemy to load the relationship in the same query as the parent using a JOIN statement.</p>
<p>Here, <code>order_by</code> lets you specify and order and returns and ordered <code>InstrumentList</code>.</p>
<p>Example of <strong>multiple One to Many</strong> relation between tables. Lets say, User has many memberships and has many membership approvals. But Membership has only one User and one Approver. Also, both member and approver are user, so two relationships. Here we have to include, <code>foreign_keys=[]</code> argument to relationship to define which foreign-key it is reffering to and avoid ambiguity.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>    <span class="o">...</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>    <span class="c1"># One to Many relationships</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>    <span class="n">memberships</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="n">Membership</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">Membership</span><span class="o">.</span><span class="n">user_id</span><span class="p">])</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>    <span class="n">memberships_approved</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="n">Membership</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s1">&#39;approver&#39;</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">Membership</span><span class="o">.</span><span class="n">approved_by</span><span class="p">])</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="k">class</span> <span class="nc">Membership</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>    <span class="o">...</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>    <span class="c1"># Many to One relationships</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>    <span class="n">user_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">))</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>    <span class="n">approved_by</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;users.id&#39;</span><span class="p">))</span>
</code></pre></div>
<p>Example, <strong>One to One</strong> relationship, like User has a Profile but only one which can have extra user details like height, weight etc. You can pass <code>uselist=False</code> to <code>relationship()</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">class</span> <span class="nc">Profile</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>    <span class="n">height</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">)</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>    <span class="n">user_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>    <span class="c1"># relationships</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a>    <span class="n">profile</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Profile&#39;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">),</span> <span class="n">uselist</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<p>Example, <strong>Many-to-Many Relationships</strong> you will need to define a helper table. Say, Post has multiple Tags and Tags have multiple Posts</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1"># this is table</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">post_tag_m2m</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;tag_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;tag.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>    <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;post_id&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;post.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="p">)</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>    <span class="n">tags</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s1">&#39;Tag&#39;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="n">post_tag_m2m</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s1">&#39;subquery&#39;</span><span class="p">,</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>        <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>Link: <a href="https://flask-sqlalchemy.palletsprojects.com/en/2.x/models/">Models - FlaskSqlAlchemy</a></p>
<h3 id="insert-or-create">Insert or Create</h3>
<p>Create an Object of Class to build a new row. Usually in a route in <code>views.py</code> or in python shell:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;john&#39;</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>
<p>Here, we create a new object. Initialize it's attributes. Finally add it to be saved. Lastly, commit it to datebase, this where <code>INSERT</code> is performed.</p>
<p>To use INSERTed object for another operation, <code>id</code> is added to object after <code>commit()</code> and is made available for use.</p>
<h3 id="read-or-select-or-query">Read or Select or Query</h3>
<p>Each model has <code>query</code> object is available. It has to be chained with <em>filter-options</em> and/or <em>executors</em> that build a SQL Query statement.</p>
<p><strong>Filter-Options</strong> - They are added to choose records. Eg, <code>filter()</code>, <code>filter_by()</code>, <code>limit()</code>, <code>offset()</code>, <code>order_by()</code>, <code>group_by()</code></p>
<p><strong>Executors</strong> - they are at end of chained methods and finally execute the query to get result set. Eg, <code>all()</code>, <code>first()</code>, <code>first_or_404()</code>, <code>get()</code>, <code>get_or_404()</code>, <code>count()</code>, <code>paginate()</code>, <code>fetch()</code>, <code>fetchall()</code>, <code>scalar()</code>.</p>
<p><strong>Imp</strong>, when refering column of a Models, <code>.c</code> is not required. When refering a col from table, like many2many join table, helper table, then use <code>.c</code> collection of columns, eg, <code>Post.query.join(followers, (followers.c.followed_id == Post.user_id))</code>.</p>
<p>Links:</p>
<ul>
<li><a href="https://docs.sqlalchemy.org/en/20/core/operators.html">operators, is_()</a></li>
<li><a href="https://docs.sqlalchemy.org/en/20/orm/queryguide/select.html#selecting-orm-entities-and-attributes">select ORM, join where</a></li>
<li><a href="https://flask-sqlalchemy.palletsprojects.com/en/3.1.x/queries/#">models - flask-sqlalchemy</a></li>
<li><a href="https://flask-sqlalchemy.palletsprojects.com/en/3.1.x/pagination/">pagination - flask-sqlalchemy</a></li>
<li><a href="https://docs.sqlalchemy.org/en/20/core/functions.html#sqlalchemy.sql.functions.count">func calculations</a></li>
<li><a href="https://docs.sqlalchemy.org/en/20/core/sqlelement.html#sqlalchemy.sql.expression.extract">extact function</a></li>
</ul>
<p><strong>scalars</strong> vs <strong>all</strong></p>
<ul>
<li>use scalar when you have whole and only one ORM object to select. That is only User and whole User (all fields of User). This will give list of User object, hence easy to use. <code>items[0].name</code> is name of first user.</li>
<li>use all when you have multiple ORM model to select or partial columns to select from orm model. It will return list of tuple having objects or columns. You have to unpack the tuple. <code>items[0].User.name</code> is name of first user.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">items</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">Author</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Author</span><span class="o">.</span><span class="n">author_id</span> <span class="o">==</span> <span class="n">Book</span><span class="o">.</span><span class="n">author_id</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># correct</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="c1"># [(&lt;Book 1&gt;, &lt;Author: [&lt;Book 1&gt;]&gt;), ... , (&lt;Book 10&gt;, &lt;Author: [&lt;Book 9&gt;, &lt;Book 10&gt;]&gt;)]</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="n">items</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">Author</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">Author</span><span class="o">.</span><span class="n">author_id</span> <span class="o">==</span> <span class="n">Book</span><span class="o">.</span><span class="n">author_id</span><span class="p">))</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="c1"># [&lt;Book 1&gt;, &lt;Book 2&gt;, ... , &lt;Book 10&gt;]</span>
</code></pre></div>
<p>More on <a href="https://stackoverflow.com/a/72791280/1055028">SO - scalars or all</a></p>
<p>Examples:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># Get list of objects</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">func</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="c1"># Select columns with calculations including Date Operations</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="n">date_in</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2023-10-22&#39;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="n">q</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>    <span class="n">func</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">Checkin</span><span class="o">.</span><span class="n">in_at</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&#39;date_in&#39;</span><span class="p">),</span>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>    <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Checkin</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">),</span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>    <span class="n">Checkin</span><span class="o">.</span><span class="n">membership_id</span>
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>        <span class="n">Checkin</span><span class="o">.</span><span class="n">deleted_on</span><span class="o">.</span><span class="n">is_</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>        <span class="n">Checkin</span><span class="o">.</span><span class="n">membership_id</span> <span class="o">==</span> <span class="mi">10</span>
<a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a>        <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">Checkin</span><span class="o">.</span><span class="n">created_at</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">date_in</span><span class="p">)),</span>
<a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a>        <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">Checkin</span><span class="o">.</span><span class="n">in_at</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">in_at</span><span class="o">.</span><span class="n">data</span><span class="p">)),</span>
<a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a>
<a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a><span class="p">)</span><span class="o">.</span><span class="n">group_by</span><span class="p">(</span>
<a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a>    <span class="n">func</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">Checkin</span><span class="o">.</span><span class="n">in_at</span><span class="p">),</span>
<a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a>    <span class="n">Checkin</span><span class="o">.</span><span class="n">membership_id</span>
<a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a><span class="p">)</span>
<a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a>
<a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a>
<a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a>
<a id="__codelineno-49-31" name="__codelineno-49-31" href="#__codelineno-49-31"></a><span class="c1"># Date Comparisions --------------------------</span>
<a id="__codelineno-49-32" name="__codelineno-49-32" href="#__codelineno-49-32"></a>
<a id="__codelineno-49-33" name="__codelineno-49-33" href="#__codelineno-49-33"></a><span class="n">begin_at</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2024-01-23 17:30&#39;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
<a id="__codelineno-49-34" name="__codelineno-49-34" href="#__codelineno-49-34"></a><span class="n">end_at</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2024-01-23 18:40&#39;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M&quot;</span><span class="p">)</span>
<a id="__codelineno-49-35" name="__codelineno-49-35" href="#__codelineno-49-35"></a>
<a id="__codelineno-49-36" name="__codelineno-49-36" href="#__codelineno-49-36"></a><span class="n">q</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-49-37" name="__codelineno-49-37" href="#__codelineno-49-37"></a>    <span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span> <span class="o">&amp;</span>
<a id="__codelineno-49-38" name="__codelineno-49-38" href="#__codelineno-49-38"></a>    <span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">deleted_on</span><span class="o">.</span><span class="n">is_</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span> <span class="o">&amp;</span>
<a id="__codelineno-49-39" name="__codelineno-49-39" href="#__codelineno-49-39"></a>    <span class="p">((</span><span class="n">Task</span><span class="o">.</span><span class="n">begin_at</span> <span class="o">&lt;=</span> <span class="n">begin_at</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">begin_at</span> <span class="o">&lt;=</span> <span class="n">Task</span><span class="o">.</span><span class="n">end_at</span><span class="p">))</span> <span class="o">|</span>
<a id="__codelineno-49-40" name="__codelineno-49-40" href="#__codelineno-49-40"></a>    <span class="p">((</span><span class="n">Task</span><span class="o">.</span><span class="n">begin_at</span> <span class="o">&lt;=</span> <span class="n">end_at</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">end_at</span> <span class="o">&lt;=</span> <span class="n">Task</span><span class="o">.</span><span class="n">end_at</span><span class="p">))</span> <span class="o">|</span>
<a id="__codelineno-49-41" name="__codelineno-49-41" href="#__codelineno-49-41"></a>    <span class="p">((</span><span class="n">begin_at</span> <span class="o">&lt;=</span> <span class="n">Task</span><span class="o">.</span><span class="n">begin_at</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Task</span><span class="o">.</span><span class="n">end_at</span> <span class="o">&lt;=</span> <span class="n">end_at</span><span class="p">))</span>
<a id="__codelineno-49-42" name="__codelineno-49-42" href="#__codelineno-49-42"></a><span class="p">)</span>
<a id="__codelineno-49-43" name="__codelineno-49-43" href="#__codelineno-49-43"></a><span class="nb">str</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<a id="__codelineno-49-44" name="__codelineno-49-44" href="#__codelineno-49-44"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>     <span class="c1"># list of id or blank id</span>
<a id="__codelineno-49-45" name="__codelineno-49-45" href="#__codelineno-49-45"></a>
<a id="__codelineno-49-46" name="__codelineno-49-46" href="#__codelineno-49-46"></a>
<a id="__codelineno-49-47" name="__codelineno-49-47" href="#__codelineno-49-47"></a><span class="c1"># Complex Where with Join   --------------------------</span>
<a id="__codelineno-49-48" name="__codelineno-49-48" href="#__codelineno-49-48"></a>
<a id="__codelineno-49-49" name="__codelineno-49-49" href="#__codelineno-49-49"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
<a id="__codelineno-49-50" name="__codelineno-49-50" href="#__codelineno-49-50"></a>    <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Gym</span><span class="p">)</span>
<a id="__codelineno-49-51" name="__codelineno-49-51" href="#__codelineno-49-51"></a>    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Membership</span><span class="p">)</span>
<a id="__codelineno-49-52" name="__codelineno-49-52" href="#__codelineno-49-52"></a>    <span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-49-53" name="__codelineno-49-53" href="#__codelineno-49-53"></a>        <span class="p">(</span><span class="n">Membership</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span>
<a id="__codelineno-49-54" name="__codelineno-49-54" href="#__codelineno-49-54"></a>        <span class="p">(</span><span class="n">Gym</span><span class="o">.</span><span class="n">active</span><span class="p">)</span> <span class="o">&amp;</span>                          <span class="c1"># Boolean</span>
<a id="__codelineno-49-55" name="__codelineno-49-55" href="#__codelineno-49-55"></a>        <span class="p">(</span><span class="o">~</span><span class="n">Gym</span><span class="o">.</span><span class="n">closed</span><span class="p">)</span> <span class="o">&amp;</span>                         <span class="c1"># Boolean Reverse</span>
<a id="__codelineno-49-56" name="__codelineno-49-56" href="#__codelineno-49-56"></a>        <span class="p">(</span><span class="n">Membership</span><span class="o">.</span><span class="n">approved_by</span><span class="o">.</span><span class="n">is_not</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>   <span class="c1"># NOT NULL</span>
<a id="__codelineno-49-57" name="__codelineno-49-57" href="#__codelineno-49-57"></a>    <span class="p">)</span>
<a id="__codelineno-49-58" name="__codelineno-49-58" href="#__codelineno-49-58"></a><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-49-59" name="__codelineno-49-59" href="#__codelineno-49-59"></a>
<a id="__codelineno-49-60" name="__codelineno-49-60" href="#__codelineno-49-60"></a>
<a id="__codelineno-49-61" name="__codelineno-49-61" href="#__codelineno-49-61"></a><span class="c1"># Build Query as Modular in Part  ---------------------</span>
<a id="__codelineno-49-62" name="__codelineno-49-62" href="#__codelineno-49-62"></a>
<a id="__codelineno-49-63" name="__codelineno-49-63" href="#__codelineno-49-63"></a><span class="n">selected</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Response</span><span class="p">)</span>
<a id="__codelineno-49-64" name="__codelineno-49-64" href="#__codelineno-49-64"></a><span class="n">clauses</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">flow_type</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="n">sql_q</span><span class="p">)</span>
<a id="__codelineno-49-65" name="__codelineno-49-65" href="#__codelineno-49-65"></a><span class="c1"># add an or clause</span>
<a id="__codelineno-49-66" name="__codelineno-49-66" href="#__codelineno-49-66"></a><span class="n">clauses</span> <span class="o">=</span> <span class="n">clauses</span> <span class="o">|</span> <span class="n">Response</span><span class="o">.</span><span class="n">error_reason</span><span class="o">.</span><span class="n">ilike</span><span class="p">(</span><span class="n">sql_q</span><span class="p">)</span>
<a id="__codelineno-49-67" name="__codelineno-49-67" href="#__codelineno-49-67"></a><span class="n">flow_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flow_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-49-68" name="__codelineno-49-68" href="#__codelineno-49-68"></a><span class="k">if</span> <span class="p">(</span><span class="n">flow_id</span><span class="p">):</span>
<a id="__codelineno-49-69" name="__codelineno-49-69" href="#__codelineno-49-69"></a>    <span class="c1"># add an and clause</span>
<a id="__codelineno-49-70" name="__codelineno-49-70" href="#__codelineno-49-70"></a>    <span class="n">clauses</span> <span class="o">=</span> <span class="p">(</span><span class="n">clauses</span><span class="p">)</span> <span class="o">&amp;</span>  <span class="p">(</span><span class="n">Response</span><span class="o">.</span><span class="n">flow_id</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">flow_id</span><span class="p">)</span> <span class="p">)</span>
<a id="__codelineno-49-71" name="__codelineno-49-71" href="#__codelineno-49-71"></a><span class="n">filtered</span> <span class="o">=</span> <span class="n">selected</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">clauses</span><span class="p">)</span>
<a id="__codelineno-49-72" name="__codelineno-49-72" href="#__codelineno-49-72"></a><span class="n">ordered</span> <span class="o">=</span> <span class="n">filtered</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Response</span><span class="o">.</span><span class="n">responded_at</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span>
<a id="__codelineno-49-73" name="__codelineno-49-73" href="#__codelineno-49-73"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-49-74" name="__codelineno-49-74" href="#__codelineno-49-74"></a>
<a id="__codelineno-49-75" name="__codelineno-49-75" href="#__codelineno-49-75"></a>
<a id="__codelineno-49-76" name="__codelineno-49-76" href="#__codelineno-49-76"></a>
<a id="__codelineno-49-77" name="__codelineno-49-77" href="#__codelineno-49-77"></a><span class="c1"># Pagination</span>
<a id="__codelineno-49-78" name="__codelineno-49-78" href="#__codelineno-49-78"></a>
<a id="__codelineno-49-79" name="__codelineno-49-79" href="#__codelineno-49-79"></a><span class="n">paginated_responses</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span>
<a id="__codelineno-49-80" name="__codelineno-49-80" href="#__codelineno-49-80"></a>    <span class="n">ordered</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<a id="__codelineno-49-81" name="__codelineno-49-81" href="#__codelineno-49-81"></a>    <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">error_out</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-49-82" name="__codelineno-49-82" href="#__codelineno-49-82"></a><span class="c1"># above will give 5 pages, with 10 on each due to limit.</span>
<a id="__codelineno-49-83" name="__codelineno-49-83" href="#__codelineno-49-83"></a>
<a id="__codelineno-49-84" name="__codelineno-49-84" href="#__codelineno-49-84"></a><span class="n">users</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">join_date</span><span class="p">))</span>
<a id="__codelineno-49-85" name="__codelineno-49-85" href="#__codelineno-49-85"></a>
<a id="__codelineno-49-86" name="__codelineno-49-86" href="#__codelineno-49-86"></a>
<a id="__codelineno-49-87" name="__codelineno-49-87" href="#__codelineno-49-87"></a><span class="c1"># Get ScalarResult, not scriptable, but works with for</span>
<a id="__codelineno-49-88" name="__codelineno-49-88" href="#__codelineno-49-88"></a>
<a id="__codelineno-49-89" name="__codelineno-49-89" href="#__codelineno-49-89"></a><span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">))</span><span class="o">.</span><span class="n">scalar_one</span><span class="p">()</span>
<a id="__codelineno-49-90" name="__codelineno-49-90" href="#__codelineno-49-90"></a>
<a id="__codelineno-49-91" name="__codelineno-49-91" href="#__codelineno-49-91"></a><span class="n">users</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">))</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span>
<a id="__codelineno-49-92" name="__codelineno-49-92" href="#__codelineno-49-92"></a>
<a id="__codelineno-49-93" name="__codelineno-49-93" href="#__codelineno-49-93"></a><span class="n">users</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">))</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span>
<a id="__codelineno-49-94" name="__codelineno-49-94" href="#__codelineno-49-94"></a>
<a id="__codelineno-49-95" name="__codelineno-49-95" href="#__codelineno-49-95"></a><span class="n">u</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-49-96" name="__codelineno-49-96" href="#__codelineno-49-96"></a>
<a id="__codelineno-49-97" name="__codelineno-49-97" href="#__codelineno-49-97"></a><span class="n">u</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sandy&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">scalar_one</span><span class="p">()</span>
<a id="__codelineno-49-98" name="__codelineno-49-98" href="#__codelineno-49-98"></a>
<a id="__codelineno-49-99" name="__codelineno-49-99" href="#__codelineno-49-99"></a><span class="n">u</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">fullname</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">scalar_one</span><span class="p">()</span>
<a id="__codelineno-49-100" name="__codelineno-49-100" href="#__codelineno-49-100"></a>
<a id="__codelineno-49-101" name="__codelineno-49-101" href="#__codelineno-49-101"></a>
<a id="__codelineno-49-102" name="__codelineno-49-102" href="#__codelineno-49-102"></a><span class="c1"># view queries</span>
<a id="__codelineno-49-103" name="__codelineno-49-103" href="#__codelineno-49-103"></a>
<a id="__codelineno-49-104" name="__codelineno-49-104" href="#__codelineno-49-104"></a><span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
<a id="__codelineno-49-105" name="__codelineno-49-105" href="#__codelineno-49-105"></a>
<a id="__codelineno-49-106" name="__codelineno-49-106" href="#__codelineno-49-106"></a><span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">one_or_404</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">))</span>
<a id="__codelineno-49-107" name="__codelineno-49-107" href="#__codelineno-49-107"></a>
<a id="__codelineno-49-108" name="__codelineno-49-108" href="#__codelineno-49-108"></a>
<a id="__codelineno-49-109" name="__codelineno-49-109" href="#__codelineno-49-109"></a><span class="c1"># 404 with message for abort</span>
<a id="__codelineno-49-110" name="__codelineno-49-110" href="#__codelineno-49-110"></a>
<a id="__codelineno-49-111" name="__codelineno-49-111" href="#__codelineno-49-111"></a><span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">one_or_404</span><span class="p">(</span>
<a id="__codelineno-49-112" name="__codelineno-49-112" href="#__codelineno-49-112"></a>    <span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">),</span>
<a id="__codelineno-49-113" name="__codelineno-49-113" href="#__codelineno-49-113"></a>    <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;No user named &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
<a id="__codelineno-49-114" name="__codelineno-49-114" href="#__codelineno-49-114"></a><span class="p">)</span>
<a id="__codelineno-49-115" name="__codelineno-49-115" href="#__codelineno-49-115"></a>
<a id="__codelineno-49-116" name="__codelineno-49-116" href="#__codelineno-49-116"></a>
<a id="__codelineno-49-117" name="__codelineno-49-117" href="#__codelineno-49-117"></a><span class="c1"># ORM Queries</span>
<a id="__codelineno-49-118" name="__codelineno-49-118" href="#__codelineno-49-118"></a><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">user_table</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">user_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;spongebob&quot;</span><span class="p">)</span>
<a id="__codelineno-49-119" name="__codelineno-49-119" href="#__codelineno-49-119"></a>
<a id="__codelineno-49-120" name="__codelineno-49-120" href="#__codelineno-49-120"></a>
<a id="__codelineno-49-121" name="__codelineno-49-121" href="#__codelineno-49-121"></a><span class="c1"># JOINs</span>
<a id="__codelineno-49-122" name="__codelineno-49-122" href="#__codelineno-49-122"></a><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">user_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">address_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">email_address</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">address_table</span><span class="p">)</span>
<a id="__codelineno-49-123" name="__codelineno-49-123" href="#__codelineno-49-123"></a>
<a id="__codelineno-49-124" name="__codelineno-49-124" href="#__codelineno-49-124"></a><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">address_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">email_address</span><span class="p">)</span>
<a id="__codelineno-49-125" name="__codelineno-49-125" href="#__codelineno-49-125"></a>  <span class="o">.</span><span class="n">select_from</span><span class="p">(</span><span class="n">user_table</span><span class="p">)</span>
<a id="__codelineno-49-126" name="__codelineno-49-126" href="#__codelineno-49-126"></a>  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">address_table</span><span class="p">,</span> <span class="n">user_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">address_table</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-49-127" name="__codelineno-49-127" href="#__codelineno-49-127"></a>
<a id="__codelineno-49-128" name="__codelineno-49-128" href="#__codelineno-49-128"></a>
<a id="__codelineno-49-129" name="__codelineno-49-129" href="#__codelineno-49-129"></a><span class="c1"># outer join</span>
<a id="__codelineno-49-130" name="__codelineno-49-130" href="#__codelineno-49-130"></a><span class="nb">print</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">user_table</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">address_table</span><span class="p">,</span> <span class="n">isouter</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<a id="__codelineno-49-131" name="__codelineno-49-131" href="#__codelineno-49-131"></a><span class="nb">print</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">user_table</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">address_table</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<a id="__codelineno-49-132" name="__codelineno-49-132" href="#__codelineno-49-132"></a>
<a id="__codelineno-49-133" name="__codelineno-49-133" href="#__codelineno-49-133"></a>
<a id="__codelineno-49-134" name="__codelineno-49-134" href="#__codelineno-49-134"></a><span class="c1"># order group having</span>
<a id="__codelineno-49-135" name="__codelineno-49-135" href="#__codelineno-49-135"></a><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">))</span>
<a id="__codelineno-49-136" name="__codelineno-49-136" href="#__codelineno-49-136"></a>        <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Address</span><span class="p">)</span>
<a id="__codelineno-49-137" name="__codelineno-49-137" href="#__codelineno-49-137"></a>        <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-49-138" name="__codelineno-49-138" href="#__codelineno-49-138"></a>        <span class="o">.</span><span class="n">having</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-49-139" name="__codelineno-49-139" href="#__codelineno-49-139"></a>
<a id="__codelineno-49-140" name="__codelineno-49-140" href="#__codelineno-49-140"></a><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Address</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="s2">&quot;num_addresses&quot;</span><span class="p">))</span>
<a id="__codelineno-49-141" name="__codelineno-49-141" href="#__codelineno-49-141"></a>    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
<a id="__codelineno-49-142" name="__codelineno-49-142" href="#__codelineno-49-142"></a>    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="p">(</span><span class="s2">&quot;num_addresses&quot;</span><span class="p">)</span>
</code></pre></div>
<p><strong>DEBUG</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># print query</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">compile_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;literal_binds&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}))</span>
</code></pre></div>
<p>More on <a href="https://stackoverflow.com/a/45551136/1055028">https://stackoverflow.com/a/45551136/1055028</a></p>
<p>Examples, <strong>OLD and Legacy</strong>, uses <code>Model.query</code>, Prefer using <code>db.session.execute(db.select(...))</code> instead.:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1"># select by primary key, ID</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># 1 is id in table</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="n">u</span><span class="o">.</span><span class="n">name</span>                  <span class="c1"># prints name</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="n">posts</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>   <span class="c1"># if user has 1-m relationship with Post table</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="c1"># SELECT</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="c1"># select WHERE</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="n">admins</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="c1"># select TOP 1 where</span>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;johndoe&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="c1"># u is None if username does not exist</span>
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a>
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="c1"># Select TOP n or LIMIT</span>
<a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a>
<a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="c1"># WHERE column ENDSWITH</span>
<a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;@example.com&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a>
<a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="c1"># ORDER BY</span>
<a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a>
<a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="c1"># Get SQL query Statement, see there is no executor</span>
<a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="n">sql_stmt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">))</span>
<a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a>
<a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="c1"># 404 errors, this will raise 404 errors instead of returning None</span>
<a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/user/&lt;username&gt;&#39;</span><span class="p">)</span>
<a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="k">def</span> <span class="nf">show_user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first_or_404</span><span class="p">()</span>
<a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_or_404</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a>    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;show_user.html&#39;</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
<a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a>
<a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a><span class="c1"># Pagination</span>
<a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a><span class="n">page</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">join_date</span><span class="p">)</span><span class="o">.</span><span class="n">paginate</span><span class="p">()</span>
<a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a>
<a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a><span class="c1"># Joins</span>
<a id="__codelineno-51-39" name="__codelineno-51-39" href="#__codelineno-51-39"></a>
<a id="__codelineno-51-40" name="__codelineno-51-40" href="#__codelineno-51-40"></a><span class="n">Post</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-51-41" name="__codelineno-51-41" href="#__codelineno-51-41"></a>
<a id="__codelineno-51-42" name="__codelineno-51-42" href="#__codelineno-51-42"></a><span class="n">followed</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
<a id="__codelineno-51-43" name="__codelineno-51-43" href="#__codelineno-51-43"></a>            <span class="n">followers</span><span class="p">,</span> <span class="p">(</span><span class="n">followers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">followed_id</span> <span class="o">==</span> <span class="n">Post</span><span class="o">.</span><span class="n">user_id</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
<a id="__codelineno-51-44" name="__codelineno-51-44" href="#__codelineno-51-44"></a>                <span class="n">followers</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">follower_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</code></pre></div>
<p>For pagination, during a request, this will take page and per_page arguments from the query string request.args. Pass max_per_page to prevent users from requesting too many results on a single page. If not given, the default values will be page 1 with 20 items per page.</p>
<p>Link:</p>
<ul>
<li><a href="https://flask-sqlalchemy.palletsprojects.com/en/2.x/quickstart/">Quickstart - flask-sqlalchemy</a></li>
<li><a href="https://stackoverflow.com/questions/51451768/sqlalchemy-querying-with-datetime-columns-to-filter-by-month-day-year">Date Filters</a></li>
</ul>
<h3 id="update">Update</h3>
<p>Load the object, modify its attributes, then do <code>add</code> and <code>commit</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># 1 is id in table</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">u</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;staff&#39;</span>        <span class="c1"># modified attribute</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>    <span class="c1"># ready to save</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>     <span class="c1"># UPDATE is performed</span>
</code></pre></div>
<h3 id="delete">Delete</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># 1 is id in table</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>     <span class="c1"># DELETE is performed</span>
</code></pre></div>
<h3 id="raw-sql">RAW SQL</h3>
<p>Give your SQL statements</p>
<ul>
<li><code>db.session.execute(SQL)</code> returns cursor</li>
<li><code>db.session.execute(SQL).all()</code> - returns List result set</li>
</ul>
<p><strong>Engine object</strong></p>
<p>You can get the <code>Engine</code> object from the current session connection using, property engine / engines or method <code>get_engine()</code>. more on: <a href="https://flask-sqlalchemy.palletsprojects.com/en/latest/api/#flask_sqlalchemy.SQLAlchemy.engine">engine docs</a></p>
<p><strong>Shell Operations</strong></p>
<p>CRUD from Flask Shell</p>
<ul>
<li><code>flask --app hello.py shell</code> start shell with <em>app_context</em>, python shell will not have that.</li>
<li><code>db.create_all()</code> creates SQLite file.</li>
</ul>
<p><strong>Extras - Database Schema</strong></p>
<p>For MS-SQL you may need to use schema name along with table and database name. It can be defined in configuration and then used in models. <strong>db.metadatas</strong> - You can add schema of table in model using:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">metadatas</span><span class="p">[</span><span class="s1">&#39;SCHEMA&#39;</span><span class="p">]}</span>
</code></pre></div>
<p>and define schema in metadata when initializing <code>db</code> object in <code>__init__.py</code> of app using:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">db</span><span class="o">.</span><span class="n">metadatas</span><span class="p">[</span><span class="s1">&#39;SCHEMA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SCHEMA&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;[dbo]&quot;</span>
</code></pre></div>
<p>You can also add more metadata here, like database name.</p>
<p><strong>Extras - Py ORM Model from SQL</strong></p>
<p>If you have a existing tables in database and want o Generate SQLAlchemy class model from database table - <code>sqlacodegen mssql+pyodbc://&lt;servername&gt;\&lt;schema&gt;/&lt;database&gt;/&lt;table_name&gt;?driver=SQL+Server --outfile db.py</code></p>
<h3 id="multiple-database-connections">Multiple Database Connections</h3>
<p>You can connect to multiple database with Flask-SQLAlchemy. It connects to different databases and creates different engines. All you have to do is pass the <code>bind_key</code> in any call to db.</p>
<p>More on <a href="https://flask-sqlalchemy.palletsprojects.com/en/latest/binds/">https://flask-sqlalchemy.palletsprojects.com/en/latest/binds/</a></p>
<h2 id="migrations-in-database">Migrations in Database</h2>
<ul>
<li><strong>Why?</strong> - When DB is handled using ORM, all changes to DB is done via ORM. If you have to add a column it is added by ORM so it will delete the table and create new but to prevent data loss in table it will create a migration script to create and populate again.</li>
</ul>
<ul>
<li><strong>What?</strong> - <code>Flask-Migrate</code> is wrapper on <code>Alembic</code> a SQLAlchemy migration framework. It generates Py script to keep the database schema updated with the models defined. It help upgrade and roll back the schemas.</li>
</ul>
<ul>
<li><strong>Installation</strong> - <code>pip install flask-migrate</code></li>
</ul>
<p><strong>Initiation</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>from<span class="w"> </span>flask_migrate<span class="w"> </span>import<span class="w"> </span>Migrate
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="nv">migrate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Migrate<span class="o">(</span>app,<span class="w"> </span>db<span class="o">)</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>flask<span class="w"> </span>--app<span class="w"> </span>hello.py<span class="w"> </span>db<span class="w"> </span>init
</code></pre></div>
<p>This generates migration directory, script is generated</p>
<ul>
<li><strong>Execution</strong><ul>
<li><code>upgrade()</code> has data changes to be done in this migration</li>
<li><code>downgrade()</code> rolls back to previous state</li>
<li>Example: Steps to make a migration<ul>
<li>Make changes to model classes</li>
<li><code>flask --app hello.py db migrate -m "initial migration"</code> to generate script</li>
<li>review for accurate changes. add to source control</li>
<li><code>flask--app hello.py db upgrade</code> to do migration in database</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Reference</strong><ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-make-a-web-application-using-flask-in-python-3">How To Make a Web Application Using Flask in Python 3</a></li>
<li><a href="https://sqlitebrowser.org/">SQLite explorer</a></li>
</ul>
</li>
</ul>
<h2 id="login-in-flask-flask-login">Login in Flask - Flask Login</h2>
<p>Flask-Login is minimal and powerful tool to manage logins in flask. It does the job and gives the flexibility as well to handle things</p>
<h3 id="role-based-control">Role based control</h3>
<p>You may also need to check role of user when logged in. For this you can build your own decorator function and use with login_required. Eg:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">url_for</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="kn">from</span> <span class="nn">flask_login</span> <span class="kn">import</span> <span class="n">current_user</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="c1"># define below somewhere (utils or lib) and import in views</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="k">def</span> <span class="nf">role_required</span><span class="p">(</span><span class="o">*</span><span class="n">roles</span><span class="p">):</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>        <span class="k">def</span> <span class="nf">decorated_function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>            <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
<a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a>                <span class="n">flash</span><span class="p">(</span><span class="s1">&#39;You do not have permission to do that.&#39;</span><span class="p">,</span> <span class="s1">&#39;danger&#39;</span><span class="p">)</span>
<a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a>                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a>
<a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a>            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a>        <span class="k">return</span> <span class="n">decorated_function</span>
<a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a>    <span class="k">return</span> <span class="n">decorator</span>
<a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a>
<a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a>
<a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a>
<a id="__codelineno-57-22" name="__codelineno-57-22" href="#__codelineno-57-22"></a><span class="c1"># For all requests in a blueprint</span>
<a id="__codelineno-57-23" name="__codelineno-57-23" href="#__codelineno-57-23"></a><span class="nd">@bp</span><span class="o">.</span><span class="n">before_request</span>
<a id="__codelineno-57-24" name="__codelineno-57-24" href="#__codelineno-57-24"></a><span class="nd">@login_required</span>
<a id="__codelineno-57-25" name="__codelineno-57-25" href="#__codelineno-57-25"></a><span class="nd">@role_required</span><span class="p">(</span><span class="s1">&#39;member&#39;</span><span class="p">,</span> <span class="s1">&#39;staff&#39;</span><span class="p">)</span>
<a id="__codelineno-57-26" name="__codelineno-57-26" href="#__codelineno-57-26"></a><span class="k">def</span> <span class="nf">before_request</span><span class="p">():</span>
<a id="__codelineno-57-27" name="__codelineno-57-27" href="#__codelineno-57-27"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Protect all of the checkin endpoints. &quot;&quot;&quot;</span>
<a id="__codelineno-57-28" name="__codelineno-57-28" href="#__codelineno-57-28"></a>    <span class="k">pass</span>
<a id="__codelineno-57-29" name="__codelineno-57-29" href="#__codelineno-57-29"></a>
<a id="__codelineno-57-30" name="__codelineno-57-30" href="#__codelineno-57-30"></a><span class="c1"># For individual routes</span>
<a id="__codelineno-57-31" name="__codelineno-57-31" href="#__codelineno-57-31"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;int:id&gt;/delete&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<a id="__codelineno-57-32" name="__codelineno-57-32" href="#__codelineno-57-32"></a><span class="nd">@role_required</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;staff&#39;</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">)</span>
<a id="__codelineno-57-33" name="__codelineno-57-33" href="#__codelineno-57-33"></a><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
<a id="__codelineno-57-34" name="__codelineno-57-34" href="#__codelineno-57-34"></a>    <span class="k">pass</span>
</code></pre></div>
<h2 id="emails-in-flask">Emails in Flask</h2>
<ul>
<li><strong>Why</strong> password reset, confirmations</li>
</ul>
<ul>
<li><strong>How?</strong><ul>
<li>Emails can be sent using <code>smtplib</code> package from Python standard library.</li>
<li>Email is sent by <strong>connecting</strong> to <strong>SMTP Server</strong> which takes request to send email to recipient.</li>
<li><strong>Localhost</strong> on <strong>port 25</strong> is local server that can send email.</li>
<li><strong>External</strong> SMTP server like <code>mail.googlemail.com</code> on <code>587</code> port can be used to send emails through <strong>Google Gmail</strong> account.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Flask-Mail</strong> is a extension that wraps <code>smtplib</code><ul>
<li><strong>Installation</strong> <code>pip install flask-mail</code></li>
<li><strong>import</strong> <code>from flask_mail import Mail, Message</code></li>
<li><strong>instantiate</strong> and initialize <code>mail = Mail(app)</code></li>
<li><strong>build</strong> obj <code>msg_obj = Message('sub','sender','to')</code></li>
<li><strong>add body</strong> and html to obj, may use template for it <code>msg.body = render_template(template + '.txt', **kwargs)</code></li>
<li><strong>send</strong> <code>mail.send(msg_obj)</code></li>
</ul>
</li>
</ul>
<ul>
<li><strong>Sending Asynchronous Email</strong><ul>
<li>Message() object can be build in mail python file but Mail() object, which sends the email using msg_obj, should run in separate thread to avoid lags.</li>
<li>use python Thread() class from <strong>threading</strong> package to make new thread that runs the send_async_email(app,msg) functions. this functions has<ul>
<li>app object of FLask() for context</li>
<li>msg object of Message() for content</li>
<li>uses mail object of Mail() to send.</li>
</ul>
</li>
<li><code>from threading import Thread</code></li>
<li>The function which build Message(), add line<ul>
<li><code>thr = Thread(target=send_async_email, args=[app, msg])</code> - build thread obj</li>
<li><code>thr.start()</code> execute thread separately</li>
<li><code>return thr</code> [ ] why this is added</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Local Email Server</strong><ul>
<li><code>(venv) $ python -m smtpd -n -c DebuggingServer localhost:8025</code> this command starts emulated email server.</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>Variables</strong> that we might need to <strong>export</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MAIL_SERVER</span><span class="o">=</span>smtp.googlemail.com
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MAIL_PORT</span><span class="o">=</span><span class="m">587</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MAIL_USE_TLS</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MAIL_USERNAME</span><span class="o">=</span>email_id@domain.com
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MAIL_PASSWORD</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>Email is only sent when FLASK_ENV = production</li>
</ul>
<ul>
<li><strong>Sending errors via Email</strong><ul>
<li>Errors can be sent via email using Logs.</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>Dev - send emails to console</strong></p>
<ul>
<li><code>MAIL_SERVER = 'localhost'</code></li>
<li><code>MAIL_PORT = 8025</code></li>
<li><code>python -m smtpd -n -c DebuggingServer localhost:8025</code></li>
</ul>
<ul>
<li>Links<ul>
<li><a href="https://flask.palletsprojects.com/en/2.2.x/logging/#email-errors-to-admins">Flask docs - Email errors to admin</a></li>
<li><a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-vii-unit-testing-legacy#:~:text=of%20the%20application.-,Sending%20errors%20via%20email,-To%20address%20our">MG's microblog - email errors</a></li>
<li><a href="https://pythonbasics.org/flask-mail/">Pythonbasics - Flask Mail</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="blueprint-large-app-structure-in-flask">Blueprint - Large App Structure in Flask</h2>
<p><em>needs improvements after hands-on</em></p>
<ul>
<li>simply, module is file, package is folder. Blueprint can be implemented in both.</li>
</ul>
<ul>
<li><strong>single module</strong> - <a href="https://github.com/mjhea0/flask-tracking/tree/part-0">link</a><ul>
<li>
<p>here, one file has everything defined</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>/prj
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">    </span>my-app.py<span class="w"> </span><span class="c1"># imports, app, db, orm_class, form_class, route_view_functions, run</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">    </span>/static
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">    </span>/templates
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox"/> no package, Blueprints as modules?</li>
</ul>
<ul>
<li><strong>single package</strong>, Blueprints as modules - <a href="https://github.com/mjhea0/flask-tracking/tree/part-1">link</a><ul>
<li>here all ORM &amp; FORM classes are in one module</li>
<li>
<p>more complex, app-factory, no ORM, installable example with same structure, <a href="https://github.com/pallets/flask/tree/main/examples/tutorial">here</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>/prj
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">    </span>run.py<span class="w">          </span><span class="c1"># import app, db. then run. What parts to run?</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">    </span>config.py<span class="w">       </span><span class="c1"># module. config vars. With which configurations?</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="w">    </span>/my-app<span class="w">         </span><span class="c1"># package</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">        </span>__init__.py<span class="w"> </span><span class="c1"># app, register BP</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">        </span>forms.py<span class="w">    </span><span class="c1"># module. has form classes</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">        </span>models.py<span class="w">   </span><span class="c1"># module. DB setup. has ORM classes.</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="w">        </span>auth.py<span class="w">     </span><span class="c1"># module BP. import db, form, model. route-view-functions. login, register, logout. @login_required.</span>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="w">        </span>blog.py<span class="w">     </span><span class="c1"># module BP. import db, form, model. route-view-functions. CRUD.</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="w">        </span>/template
<a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="w">        </span>/static
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>multi-packages</strong>, Blueprints as sub-packages - <a href="https://github.com/mjhea0/flask-tracking/tree/part-2">link</a><ul>
<li>here ORM &amp; FORM classes are in separate module for each Blueprint.</li>
<li>DB is top-level as it is shared by all sub-packages</li>
<li>
<p>auth is top-level to avoid circular dependencies.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>/prj
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">    </span>run.py<span class="w">              </span><span class="c1"># same. import app, db. then run</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="w">    </span>config.py<span class="w">           </span><span class="c1"># same. module. config vars</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w">    </span>/my-app<span class="w">             </span><span class="c1"># package</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">        </span>__init__.py<span class="w">     </span><span class="c1"># app, register BP</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="w">        </span>auth.py<span class="w">         </span><span class="c1"># login init. login_manager</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">        </span>data.py<span class="w">         </span><span class="c1"># db setup, init, open, close. crud helpers</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="w">        </span>/users
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="w">            </span>__init__.py<span class="w"> </span><span class="c1"># blank</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="w">            </span>forms.py<span class="w">    </span><span class="c1"># module. has form classes. LoginForm, RegisterForm</span>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="w">            </span>models.py<span class="w">   </span><span class="c1"># module. has ORM classes. User.</span>
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="w">            </span>views.py<span class="w">    </span><span class="c1"># BP Module. imports form, model. defines route-view-functions</span>
<a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a>
<a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="w">        </span>/blog
<a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a><span class="w">            </span>__init__.py<span class="w"> </span><span class="c1"># blank</span>
<a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="w">            </span>forms.py<span class="w">    </span><span class="c1"># module. has form classes. CreateBlogForm, EditBlogForm</span>
<a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="w">            </span>models.py<span class="w">   </span><span class="c1"># module. has ORM classes. Post, Follower.</span>
<a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a><span class="w">            </span>views.py<span class="w">    </span><span class="c1"># BP Module. imports form, model. defines route-view-functions</span>
<a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a><span class="w">            </span>geodata.py<span class="w">  </span><span class="c1"># module. helper functions.</span>
<a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a>
<a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a><span class="w">        </span>/template
<a id="__codelineno-61-23" name="__codelineno-61-23" href="#__codelineno-61-23"></a><span class="w">        </span>/static
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>Example - <a href="https://github.com/miguelgrinberg/flasky">Miguel Grinbers's Flasky</a><ul>
<li>app-factory using <code>create_app()</code> in init.</li>
<li>models are all in one module, not in blueprint package. [ ] why? probably all BP use models</li>
<li>blueprint as sub-package's <code>__init__.py</code>, not views. [ ] why?</li>
<li>
<p>api package has multiple modules, all have route-view-functions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>prj/
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="w">    </span>run.py<span class="w">      </span><span class="c1"># imports create_app, db, ORM-models. app init. flasky.py</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="w">    </span>config.py<span class="w">   </span><span class="c1"># module. config class with vars. EnvDict</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="w">    </span>/app
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">        </span>__init__.py<span class="w"> </span><span class="c1"># import config, extensions. add extensions. def create_app.</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">        </span>models.py<span class="w">   </span><span class="c1"># import db, login_manager. def all ORM and Mixin classes</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="w">        </span>/auth
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="w">            </span>__init.py<span class="w"> </span><span class="c1"># define BP. import views</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="w">            </span>forms.py<span class="w">  </span><span class="c1"># import ORM. Form classes</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="w">            </span>views.py<span class="w">  </span><span class="c1"># import db, Forms, ORMs. def route-view-functions login, logout, register, reset</span>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a><span class="w">        </span>/main
<a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a><span class="w">            </span>__init.py<span class="w"> </span><span class="c1"># define BP. import routes</span>
<a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a><span class="w">            </span>forms.py<span class="w">  </span><span class="c1"># import ORM. Form classes</span>
<a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a><span class="w">            </span>views.py<span class="w">  </span><span class="c1"># import db, Forms, ORMs. def route-view-functions</span>
<a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="w">        </span>/api
<a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a><span class="w">            </span>__init.py<span class="w">         </span><span class="c1"># define BP. import each routes</span>
<a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="w">            </span>authentication.py<span class="w"> </span><span class="c1"># import ORM, api. def route-view-functions tokens</span>
<a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="w">            </span>comments.py<span class="w">       </span><span class="c1"># import db, ORM, api. def route-view-functions tokens</span>
<a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="w">            </span>posts.py<span class="w">          </span><span class="c1"># import db, ORM, api. def route-view-functions tokens</span>
<a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a><span class="w">            </span>users.py<span class="w">          </span><span class="c1"># import ORMs, api. def route-view-functions users, follower</span>
<a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a><span class="w">        </span>/static
<a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a><span class="w">        </span>/templates
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>Example - <a href="https://github.com/miguelgrinberg/microblog">Miguel Grinbers's microblog</a><ul>
<li>same as above, flasky</li>
<li>
<p>in sub-packages, views.py is routes.py</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>prj/
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">    </span>run.py<span class="w">      </span><span class="c1"># imports create_app, db, ORM-models. app init.</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">    </span>config.py<span class="w">   </span><span class="c1"># module. config class with vars</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span>/app
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">        </span>__init__.py<span class="w"> </span><span class="c1"># import config. add extensions. def create_app. import models.</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">        </span>models.py<span class="w">   </span><span class="c1"># all ORM and Mixin classes</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="w">        </span>/auth
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="w">            </span>__init.py<span class="w"> </span><span class="c1"># define BP. import routes</span>
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="w">            </span>forms.py<span class="w">  </span><span class="c1"># import ORM. Form classes</span>
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="w">            </span>routes.py<span class="w"> </span><span class="c1"># import db, bp, Forms, ORMs. def route-view-functions login, logout, register, reset</span>
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="w">        </span>/main
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="w">            </span>__init.py<span class="w"> </span><span class="c1"># define BP. import routes</span>
<a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="w">            </span>forms.py<span class="w">  </span><span class="c1"># import ORM. Form classes</span>
<a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a><span class="w">            </span>routes.py<span class="w"> </span><span class="c1"># import db, bp, Forms, ORMs. def route-view-functions</span>
<a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="w">        </span>/api
<a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a><span class="w">            </span>__init.py<span class="w"> </span><span class="c1"># define BP. import routes</span>
<a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a><span class="w">            </span>tokens.py<span class="w"> </span><span class="c1"># import db, bp. def route-view-functions tokens</span>
<a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a><span class="w">            </span>users.py<span class="w">  </span><span class="c1"># import db, bp, ORMs. def route-view-functions users, follower</span>
<a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a><span class="w">        </span>/static
<a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a><span class="w">        </span>/templates
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>Example - <a href="https://github.com/miguelgrinberg/microblog-api">Miguel Grinbers's microblog-api</a><ul>
<li>app-factory using create_app in app.py</li>
<li>Blueprints as modules</li>
<li>
<p>single package</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>/prj
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="w">    </span>run.py
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="w">    </span>config.py
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="w">    </span>api/
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">        </span>__init__.py<span class="w"> </span><span class="c1"># imports create_app, db</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">        </span>app.py<span class="w">      </span><span class="c1"># create_app, db init, registers BP</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="w">        </span>auth.py<span class="w">     </span><span class="c1"># import db, model. login functions</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="w">        </span>models.py<span class="w">   </span><span class="c1"># import db. ORM classes</span>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="w">        </span>posts.py<span class="w">    </span><span class="c1"># BP. imports db, ORM. route-view-functions posts, feed</span>
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="w">        </span>tokens.py<span class="w">   </span><span class="c1"># BP. imports db, ORM. route-view-functions tokens, reset_token</span>
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="w">        </span>users.py<span class="w">    </span><span class="c1"># BP. imports db, ORM. route-view-functions users, me, followers</span>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="w">        </span>templates/<span class="w">  </span><span class="c1"># only email reset html</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>Example - <a href="https://github.com/miguelgrinberg/microblog-2012">Miguel Grinbers's microblog-2012</a><ul>
<li>separate module for model, form, email and view.</li>
<li>no blueprint, no app-factory, no sub-package</li>
</ul>
</li>
</ul>
<ul>
<li>what looks good - why?<ul>
<li>app-factory - gives flexibility</li>
<li>config - for env separation<ul>
<li>use config class for defaults and different envs</li>
<li>use YAML file to read secrets and keep it out of git</li>
<li><a href="https://flask.palletsprojects.com/en/2.2.x/config/#configuration-best-practices">more on config best practice</a></li>
</ul>
</li>
<li>blueprints as modules.</li>
<li>links<ul>
<li><a href="https://hackersandslackers.com/configure-flask-applications/">Another good tutorial</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Why?</strong> - App needs to be structured into modules as it starts growing. It also helps reuse modules.</li>
</ul>
<ul>
<li>
<p><strong>Without Blueprint</strong></p>
<ul>
<li><strong>Single py file</strong> app structure<ul>
<li><strong>import</strong> flask modules and extensions</li>
<li><strong>instantiate</strong> flask app <code>app = Flask(__name__)</code></li>
<li><strong>configure</strong> app with all configs, eg, <code>app.config['MAIL_PORT'] = 587</code></li>
<li><strong>initialize</strong> extensions, eg, <code>mail = Mail(app)</code>. Not all extensions are initialized, eg, FlaskForm</li>
<li>DB <strong>ORM</strong> Classes</li>
<li><strong>Email</strong> functions - may use templates</li>
<li><strong>Form</strong> Classes</li>
<li><strong>error</strong> handlers functions - may use templates</li>
<li><strong>routes</strong>, they may use use<ul>
<li>above extensions, eg - checks Form, sends email, writes to db, or returns an error</li>
<li>native - session, flash, g</li>
<li><strong>templates</strong>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>templates</strong> and <strong>static</strong> files structure<ul>
<li>base template is HTML, it has blocks. Block-content can be replaced or appended</li>
<li>base-template is used to build different pages which put dynamic content in blocks.</li>
<li>static files can be used from static folder.</li>
<li>example flow<ul>
<li><code>base.html</code> has blocks, title, nav, page_content</li>
<li>index or profile have <code>{% extends "base.html" %}</code>, it tells Jinja to use base.</li>
<li>block-content can be replaced or appended using <code>{{ super() }}</code></li>
<li>files from <code>static</code> folder using <code>{{ url_for('static', 'favicon.ico') }}</code></li>
<li>external packages can be imported as py_var to build content as py_var and use in content. eg - wtf template can be imported from bootstrap to build content from form_object using <code>{{ wtf.quick_form(form) }}</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Blueprint</strong> lets us divide app into mini apps. It is a collection of views, templates, static files that can be applied to an application. Blueprints are a great way to organize your application.</li>
</ul>
<ul>
<li><strong>Application Factory</strong> is way of initializing app<ul>
<li>to serve a request, when single file app in invoked, app gets initialized with configs to serve the request. You do not have flexibility to make changes to config dynamically</li>
<li>app initialization can be delayed (or controlled) by making a function to do it, called <code>factory function</code>. This can be explicitly controlled.</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>How?</strong></p>
<ul>
<li>choice - you can simply keep templates and static in one folder or can split them too and keep in blueprint sub-folders.</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>single file</strong> split</p>
<ul>
<li>in single file, you can move view-routes-functions.</li>
<li>
<p>in <code>second.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="n">second</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s2">&quot;second&quot;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="nd">@second</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/home&quot;</span><span class="p">)</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>    <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;from second&quot;</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>
<p>and in <code>app.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="kn">from</span> <span class="nn">second</span> <span class="kn">import</span> <span class="n">second</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
<a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a>    <span class="k">return</span> <span class="s2">&quot;Hi&quot;</span>
<a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a>
<a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>multiple files</strong> split</p>
<ul>
<li>make a sub-folder and add<ul>
<li>constructor</li>
<li>error-route functions</li>
<li>form classes</li>
<li>views-route functions</li>
</ul>
</li>
<li>
<p>db models and other functions still remain in main file.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="o">|-</span><span class="n">app_name</span>      <span class="c1"># 0 top level dir - any name</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>  <span class="o">|-</span><span class="n">app</span><span class="o">/</span>          <span class="c1"># 2 package having flask application</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>    <span class="o">|-</span><span class="n">templates</span><span class="o">/</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>    <span class="o">|-</span><span class="n">static</span><span class="o">/</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>    <span class="o">|-</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>   <span class="c1"># 2.1 app pkg constructor, factory</span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>    <span class="o">|-</span><span class="n">models</span><span class="o">.</span><span class="n">py</span>     <span class="c1"># 2.2 db models</span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>    <span class="o">|-</span><span class="n">email</span><span class="o">.</span><span class="n">py</span>      <span class="c1"># 2.3 email </span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>    <span class="o">|-</span><span class="n">main</span><span class="o">/</span>         <span class="c1"># 5 BP sub pkg</span>
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>      <span class="o">|-</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>   <span class="c1"># 5.1 pkg const defines BP</span>
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>      <span class="o">|-</span><span class="n">errors</span><span class="o">.</span><span class="n">py</span>     <span class="c1"># 5.2 err handlers</span>
<a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a>      <span class="o">|-</span><span class="n">forms</span><span class="o">.</span><span class="n">py</span>      <span class="c1"># 5.3 form classes</span>
<a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>      <span class="o">|-</span><span class="n">views</span><span class="o">.</span><span class="n">py</span>      <span class="c1"># 5.4 routes functions</span>
<a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a>  <span class="o">|-</span><span class="n">config</span><span class="o">.</span><span class="n">py</span>     <span class="c1"># 3 configuration variables as OOPs</span>
<a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a>  <span class="o">|-</span><span class="n">flasky</span><span class="o">.</span><span class="n">py</span>     <span class="c1"># 4 factory is invoked</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>3 - <code>config.py</code> config as OOPs<ul>
<li>the config variables like secret-key and mail-server, are now attributes of <code>Config</code> class.</li>
<li><code>Config</code> class has <code>@staticmethod</code> as <code>init_app(app)</code> which can be used to do things once app is available, i.e. initialize app and more.</li>
<li>This Config base class has common vars but can be extended to build different environment classes like dev, test, prod. that can have env specific vars like dev db-location.</li>
<li>add a dictionary <code>conf_env</code> to pick the correct env class.</li>
</ul>
</li>
<li>2 - <code>app/</code> App Package<ul>
<li>dir having code, template and static files.</li>
<li>2.1 - <code>app/__init__.py</code> App Pkg Constructor<ul>
<li>this is where we build the <code>factory function</code> to initialize app explicitly and controlled.</li>
<li>import Flask modules (only Flask)</li>
<li>import Flask-Extensions (only those that need app init)</li>
<li>instantiate extensions without <code>app</code></li>
<li>factory function <code>def create_app(conf_env):</code> function to have<ul>
<li>arg <code>conf_env</code> is dictionary key name (str) to pick required Env_Config_Class from <code>config.py</code> so that we have correct config vars.</li>
<li>instantiate app</li>
<li>add configs from object <code>app.config.from_object()</code></li>
<li>add configs to extensions using <code>ext_obj.init_app(app)</code></li>
<li>return app</li>
</ul>
</li>
<li>while this makes config available in controlled way, however, it missing <code>@app.routes()</code> and other decorators associated to <code>@app</code> like error handles. This is handled using <code>Blueprint</code>.</li>
<li>
<p>import BP file and register it with app using <code>register_blueprint()</code> method. When a blueprint is registered, any view functions, templates, static files, error handlers, etc. are <strong>connected</strong> to the application.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="kn">from</span> <span class="nn">flask_bootstrap</span> <span class="kn">import</span> <span class="n">Bootstrap</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="kn">from</span> <span class="nn">flask_sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="n">config</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="n">bootstrap</span> <span class="o">=</span> <span class="n">Bootstrap</span><span class="p">()</span>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">()</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="k">def</span> <span class="nf">create_app</span><span class="p">(</span><span class="n">config_name</span><span class="p">):</span>
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a>    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="n">config_name</span><span class="p">])</span>
<a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a>    <span class="n">config</span><span class="p">[</span><span class="n">config_name</span><span class="p">]</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a>
<a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a>    <span class="n">bootstrap</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a>    <span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a>
<a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a>    <span class="c1"># Routes or blueprints</span>
<a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a>    <span class="kn">from</span> <span class="nn">.main</span> <span class="kn">import</span> <span class="n">main</span> <span class="k">as</span> <span class="n">main_blueprint</span>
<a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a>    <span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">main_blueprint</span><span class="p">)</span>
<a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a>
<a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a>    <span class="k">return</span> <span class="n">app</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>5 Blueprint - sub pkg</p>
<ul>
<li>Blueprint is like app having routes but in dormant state until registered with an application which gives it a context.</li>
<li>Blueprint can be a single file, or structured as a sub-package having multiple modules and the package constructor creates blueprint.</li>
<li>5.1 <code>app/main/__init__.py</code> main bp creation<ul>
<li>Blueprint is native flask module</li>
<li>create object of <code>Blueprint()</code> class and pass it a name and location.</li>
<li>
<p>import associated modules</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="n">main</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span><span class="p">,</span> <span class="n">errors</span> 
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="c1"># last line to avoid circular dependency</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>5.4 <code>app/main/views.py</code> view routes<ul>
<li>route function name now has namespace with BP name as prefix, so <code>url_for('main.index')</code> should be used so that 'index' of any other BP is not picked.</li>
</ul>
</li>
<li>5.2 <code>app/main/errors.py</code> error handlers  <ul>
<li>they respond to only BP route error, for app wide use <code>app_errorhandler</code> decorator instead of <code>errorhandler</code>.</li>
</ul>
</li>
<li>5.3 <code>app/main/forms.py</code> has form objects.</li>
</ul>
</li>
</ul>
<ul>
<li>4 <code>flasky.py</code> module where app instance is denied<ul>
<li><code>create_app()</code> function is called.</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Link</strong> - <a href="http://exploreflask.com/en/latest/blueprints.html">http://exploreflask.com/en/latest/blueprints.html</a></li>
</ul>
<h2 id="testing-in-flask">Testing in Flask</h2>
<ul>
<li><strong>Why</strong><ul>
<li>function code only runs when it is called.</li>
<li>if else code is only called when condition is met.</li>
<li>ensure code for all branch and function is run by changing scenarios.</li>
<li>100% coverage is when you run all functions and code in all if else try catch is tested.</li>
<li>do test as you develop.</li>
<li><code>pytest</code> or <code>unittest</code> to test</li>
<li><code>coverage</code> to measure</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>PyTest</strong></p>
<ul>
<li>modules and functions both start with <code>test_</code></li>
<li>Fixtures are setup functions, that setup how app should behave<ul>
<li>You can build different fixtures to have different app instances or to test different interactions like client requests or CLI commands.</li>
<li>fixtures call app-factory with test configs to make app separate from dev config.</li>
<li><code>conftest.py</code> - sample below.<ul>
<li>here fixure creates app, which is then passed to other fixture for specific testing.</li>
<li><code>app.test_client()</code> lets make request to app without server. Available in <code>client</code> fixture.</li>
<li><code>app.test_cli_runner()</code> lets test CLI commands registered with app. Available in <code>runner</code> fixture.</li>
<li>these fixture names (client or runner) are passed in test_functions to use them.</li>
</ul>
</li>
<li>
<p>You can keep building fixture on top of other fixture to add predefined functionalities. Eg, on top of client add another class that can help login and logout.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="k">def</span> <span class="nf">app</span><span class="p">():</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>    <span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>    <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a>        <span class="n">init_db</span><span class="p">()</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a>    <span class="k">yield</span> <span class="n">app</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="k">def</span> <span class="nf">client</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
<a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a>    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
<a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a>
<a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a><span class="k">def</span> <span class="nf">runner</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
<a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a>    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">test_cli_runner</span><span class="p">()</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>Test Cases<ul>
<li>start with <code>test_</code> in both module and function name.</li>
<li>
<p>use <code>assert</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">create_app</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="k">def</span> <span class="nf">test_hello</span><span class="p">(</span><span class="n">client</span><span class="p">):</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">)</span>   <span class="c1"># sends this URL request</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a>    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;Hello, World!&#39;</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li><code>pytest.mark.parametrize</code> lets run the test with different params</li>
<li>to test context variables like <code>session</code> or <code>g</code> use <code>with client:</code> Otherwise it raises an error.</li>
<li><code>setup.cfg</code> can have extra configs (not mandatory).</li>
</ul>
<ul>
<li><strong>Run - Pytest</strong><ul>
<li><code>pytest</code> runs test</li>
<li><code>pytest -v</code> runs and shows all files</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>UnitTest</strong> - test small units<ul>
<li>use py native <code>import unittest</code></li>
<li>in <code>tests/test_basics.py</code><ul>
<li>import modules you need for test, <code>create_app</code>, <code>db</code></li>
<li>import modules you want to test, <code>User</code>, <code>current_app</code></li>
<li>define class <code>class BasicsTestCase(unittest.TestCase):</code><ul>
<li>build functions<ul>
<li><code>setUp()</code> runs before each test function, builds env for testing</li>
<li><code>tearDown()</code> runs after each test function, removes things from env</li>
<li><code>test_somecase()</code> these functions run as test.<ul>
<li><code>assertTrue</code> Ok if True</li>
<li><code>assertFalse</code> Ok if False</li>
<li><code>with self.assertRaises(AttributeError):</code> statement that raise error.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>tests can be written in separate py files (modules) and the folder <code>tests</code> can have <code>__init__.py</code> as blank to make it a pkg</li>
<li><code>python -m unittest</code> discovers and runs all tests.</li>
<li>to run specific test class <code>unittest mypkg.tests.test_module.TestClass</code></li>
<li>to run specific method <code>unittest mypkg.tests.test_module.TestClass -k test_method</code></li>
</ul>
</li>
</ul>
<ul>
<li><strong>Unittest vs PyTest</strong><ul>
<li>Unittest is universally accepted and is built in Python standard library</li>
<li>PyTest has lot of features and we need to write less</li>
<li>Unitest needs classes &amp; methods. Pytest only needs methods.d</li>
<li>Pytest runner has <strong>full support</strong> for test cases written in UnitTest clasees.</li>
<li><strong>Use both</strong>, OOPs of Unittest and better assert of Pytest with and its better error reporting.</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>Unittest and PyTest</strong></p>
<ul>
<li>You can use Unittest and Pytest togehter to make use of best of both.</li>
</ul>
<ul>
<li><strong>Test Parametrization</strong><ul>
<li>when you have same test-code but have to run with different input parameters.</li>
<li>Pytest uses non OOPs params, to make Unittest OOPs model work with PyTest add <code>pip install parameterized</code>.</li>
<li>then use its decorator and pass params as list of tuples to argument.</li>
<li>list is input scenarios</li>
<li><strong>Note</strong> it runs <code>setUp</code> and <code>tearDown</code> for each param.</li>
<li>tuple is variables in each scenario. One value tuple is <code>('name1',)</code></li>
<li>
<p>Eg, <code>[('name1',32), ('name2',24)]</code>, <code>@parameterized.expand([(n,) for n in range(9)])</code>, <code>@parameterized.expand(itertools.product([True, False], range(9)))</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="kn">from</span> <span class="nn">parameterized</span> <span class="kn">import</span> <span class="n">parameterized</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="o">...</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="k">class</span> <span class="nc">TestLife</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a>    <span class="c1"># ...</span>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">([(</span><span class="s1">&#39;name1&#39;</span><span class="p">,</span><span class="mi">32</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name2&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">)])</span>
<a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a>    <span class="k">def</span> <span class="nf">test_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span> <span class="c1"># this method runs the number of items in list.</span>
<a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
<a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a>        <span class="k">assert</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Test Exceptions</strong><ul>
<li>
<p><code>pytest.raises()</code> can be used to test if a certain error is raised on run time.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a>    <span class="n">data</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;corrupt_data.txt&#39;</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Mocking</strong><ul>
<li>When you have to change return value of a pre defined function. You can mock a function to return a specific value irrespective of what is passed to it without modifying its code.</li>
<li>More here on <a href="https://blog.miguelgrinberg.com/post/how-to-write-unit-tests-in-python-part-2-game-of-life#:~:text=72%20different%20tests!-,Mocking,-We%20are%20now">MG's Unit Testing - Mocking</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>Report - Coverage</strong></p>
<ul>
<li><code>coverage run -m pytest</code> runs tests and measures coverage</li>
<li><code>coverage run -m unittest</code> runs tests using unittest and measures coverage</li>
<li><code>coverage report</code> shows coverage report on CLI</li>
<li><code>coverage html</code> builds dir for detailed report<ul>
<li><code>htmlcov/index.html</code> has detailed report.</li>
<li>shows code covered and not covered.</li>
</ul>
</li>
<li>To exempt a code block from coverage, add <code># pragma: no cover</code> after code block. Make this a tough decision to skip code from testing.</li>
</ul>
<ul>
<li>more <a href="https://flask.palletsprojects.com/en/2.2.x/tutorial/tests/">here</a></li>
</ul>
</li>
</ul>
<h3 id="manual-testing">Manual Testing</h3>
<ul>
<li>Basic testing can be done using flask shell and executing functions <code>flask --app flasky.py shell</code></li>
<li>do things similar to as you do in wrinting code, like import module, create objects, call functions etc.</li>
<li>use <code>current_app</code> to use <code>app_context</code>, or</li>
<li><code>with app.app_context():</code> when using factory</li>
<li>What you test in shell should be automated by making test cases.</li>
</ul>
<p>A practical way of doing manual tests is using interactive coding and running it on python shell. You can write code in editor or shell and keep executing it line by line to see outputs as you go. Once you are happy with the code, you can put them in test cases. Below is an example that shows how to get started.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">current_app</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">create_app</span><span class="p">,</span> <span class="n">db</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>  <span class="c1"># testing</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="n">app_context</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">()</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="n">app_context</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="c1"># optional</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;WTF_CSRF_ENABLED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># no CSRF during tests</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="n">client</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="c1"># now you can do your work</span>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="kn">import</span> <span class="nn">app.db_conn</span> <span class="k">as</span> <span class="nn">db_conn</span>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="kn">import</span> <span class="nn">app.sql_snippets</span> <span class="k">as</span> <span class="nn">sql_snippets</span>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a>
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="n">book</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">attr</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>The code above builds basic app working with the configs and imports. It makes <code>client</code> available which can be used to interact with the flask routes. It also makes modules available which can be used for functionalities. More on how to use it below.</p>
<p>For <strong>non factory</strong> app, use below code to do database operations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="n">app_context</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">()</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="n">app_context</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="kn">from</span> <span class="nn">app.models</span> <span class="kn">import</span> <span class="n">Book</span><span class="p">,</span> <span class="n">Author</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Book</span><span class="p">,</span> <span class="n">Author</span><span class="p">))</span>
</code></pre></div>
<h3 id="writing-tests">Writing Tests</h3>
<p><strong>Folder Structure</strong> The below tree shows how to organise test package and modules.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a>├──<span class="w"> </span>requirements.txt<span class="w">          </span><span class="c1"># on this level, project requirements</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a>├──<span class="w"> </span>tests<span class="w">                     </span><span class="c1"># root folder for tests, this is outside app</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>│<span class="w">   </span>├──<span class="w"> </span>conftest.py<span class="w">           </span><span class="c1"># define fixtures (only in pytest)</span>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a>│<span class="w">   </span>├──<span class="w"> </span>assets<span class="w">                </span><span class="c1"># keep files here to check file upload</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a>│<span class="w">   </span>├──<span class="w"> </span>functional<span class="w">            </span><span class="c1"># tests functionality, usually routes</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>__init__.py
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a>│<span class="w">   </span>│<span class="w">   </span>├──<span class="w"> </span>test_books.py
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>│<span class="w">   </span>│<span class="w">   </span>└──<span class="w"> </span>test_users.py
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a>│<span class="w">   </span>└──<span class="w"> </span>unit<span class="w">                  </span><span class="c1"># tests units, usually models</span>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a>│<span class="w">       </span>├──<span class="w"> </span>__init__.py
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>│<span class="w">       </span>└──<span class="w"> </span>test_models.py
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a>└──<span class="w"> </span>venv
</code></pre></div>
<p><strong>Test Case Execution Sequence</strong></p>
<p>Test cases are executed in alphabetical order. But they can be lying as function in different files (modules) and in different folders (packages). So the unittest module does a scan of the repo to find all functions based on search specification.</p>
<p>Following are the steps of execution:</p>
<ol>
<li>find all files having <code>test_*</code></li>
<li>Execute <code>base_test_case.py</code></li>
<li>Find all function signatures having <code>test_somefunc():</code></li>
<li>Start with the the function signature that is alphabetically first in alphabetically first Test Class. Executes <code>setUp</code> then <code>test_func</code> then <code>tearDown</code></li>
<li>Repeat for all functions.</li>
</ol>
<p><strong>Note:</strong> Any code in any module before <code>Class</code> or in Class outside function is executed before any test case.</p>
<p><strong>Philosophy</strong> - Use <em>GIVEN.. WHEN.. THEN..</em> ideology when writing test cases. So your function for test can start as, in <code>tests/unit/test_models.py</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="kn">from</span> <span class="nn">project.models</span> <span class="kn">import</span> <span class="n">User</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="k">def</span> <span class="nf">test_new_user</span><span class="p">():</span>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="sd">    GIVEN a User model</span>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="sd">    WHEN a new User is created</span>
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="sd">    THEN check the email, hashed_password, and role fields are defined correctly</span>
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s1">&#39;johndoe@gmail.com&#39;</span><span class="p">,</span> <span class="s1">&#39;j0hnD0e&#39;</span><span class="p">)</span>
<a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a>    <span class="k">assert</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">==</span> <span class="s1">&#39;johndoe@gmail.com&#39;</span>
<a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a>    <span class="k">assert</span> <span class="n">user</span><span class="o">.</span><span class="n">hashed_password</span> <span class="o">!=</span> <span class="s1">&#39;j0hnD0e&#39;</span>
<a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a>    <span class="k">assert</span> <span class="n">user</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s1">&#39;user&#39;</span>
</code></pre></div>
<p>A common practice is to use the GIVEN-WHEN-THEN structure:</p>
<ul>
<li>GIVEN - what are the initial conditions for the test?</li>
<li>WHEN - what is occurring that needs to be tested?</li>
<li>THEN - what is the expected response?</li>
</ul>
<p><strong>Testing Web App</strong></p>
<p>Web app testing needs <code>client</code> and client needs <code>app_context</code>. They are used in test cases. So as a minimum, you need three function in a <code>Class</code> to get started. So in <code>tests/functional/test_basic.py</code> add:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="kn">import</span> <span class="nn">unittest</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">current_app</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">create_app</span><span class="p">,</span> <span class="n">db</span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="kn">import</span> <span class="nn">app.db_conn</span> <span class="k">as</span> <span class="nn">db_conn</span>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="k">class</span> <span class="nc">BasicTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">(</span><span class="s1">&#39;testing&#39;</span><span class="p">)</span>              <span class="c1"># testing</span>
<a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;WTF_CSRF_ENABLED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># no CSRF during tests</span>
<a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">()</span>
<a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app_context</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a>        <span class="n">db_conn</span><span class="o">.</span><span class="n">init_db</span><span class="p">()</span>                             <span class="c1"># destroys and builds database</span>
<a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
<a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a>
<a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app_context</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app_context</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a>
<a id="__codelineno-78-22" name="__codelineno-78-22" href="#__codelineno-78-22"></a>    <span class="k">def</span> <span class="nf">test_app_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-78-23" name="__codelineno-78-23" href="#__codelineno-78-23"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the hello from __init__.py&quot;&quot;&quot;</span>
<a id="__codelineno-78-24" name="__codelineno-78-24" href="#__codelineno-78-24"></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-78-25" name="__codelineno-78-25" href="#__codelineno-78-25"></a>        <span class="k">assert</span> <span class="n">current_app</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span>
<a id="__codelineno-78-26" name="__codelineno-78-26" href="#__codelineno-78-26"></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">)</span>
<a id="__codelineno-78-27" name="__codelineno-78-27" href="#__codelineno-78-27"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">as_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-78-28" name="__codelineno-78-28" href="#__codelineno-78-28"></a>        <span class="k">assert</span> <span class="s1">&#39;Hello, World!&#39;</span> <span class="ow">in</span> <span class="n">html</span>
</code></pre></div>
<p>You can add more functions to this calls. Each of theses functions will be new test-cases and the <code>setUp</code> and <code>tearDown</code> methods will run before and after each of them.</p>
<p><strong>Flow</strong>: You can write a SQL query, get the results in variable. Use the variables to send request to client. Very response in HTML with other variables from SQL query. Eg, query user details and get <code>{id: 1, name: 'John'}</code>. The request <code>user/1</code> and <code>assert f'{name}' in html</code>. Basically, values in DB should match in HTML and values you POST as HTTP request should appear in DB. Access restrictions on routes should work as expected. Redirects should work as expected. User is able to do all actions required.</p>
<p><strong>Imp</strong>: Please note, <code>db_conn.init_db()</code> this will run for all <code>test_*()</code> methods in the class. Do this only if required.</p>
<p><strong>Tip:</strong>: Write what you expect users to do and don't. Then code test cases. You can use <code>print</code> in test cases to debug steps. You can use manual-interactive-testing to help write test cases.</p>
<p><strong>Note</strong>: Tests are executed in <strong>alphabetical</strong> order within a class. So ensure you do, <code>test_a_upload()</code> then <code>test_b_check()</code></p>
<p><strong>Test File Upload</strong></p>
<p>You can test a page where user upload a file, and then match that result back with database update. In <code>tests/functional/test_admin.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="c1"># ... prev imports</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="kn">from</span> <span class="nn">werkzeug.datastructures</span> <span class="kn">import</span> <span class="n">FileStorage</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="k">class</span> <span class="nc">AdminTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a>    <span class="c1"># ... set up and teardown</span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a>    <span class="k">def</span> <span class="nf">test_admin_upload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;admin can upload csv&quot;&quot;&quot;</span>
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>
<a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a>
<a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a>        <span class="c1"># upload file</span>
<a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a>        <span class="n">csv_file</span> <span class="o">=</span> <span class="n">FileStorage</span><span class="p">(</span>
<a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a>            <span class="n">stream</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;tests/assets/sample.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">),</span>
<a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a>            <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;sample.csv&quot;</span><span class="p">,</span>
<a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a>            <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/csv&quot;</span>
<a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a>        <span class="p">)</span>
<a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
<a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a>            <span class="s2">&quot;admin/upload&quot;</span><span class="p">,</span>
<a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a>            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a>                <span class="s2">&quot;csv_file&quot;</span><span class="p">:</span> <span class="n">csv_file</span><span class="p">,</span>
<a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a>            <span class="p">},</span>
<a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a>            <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;multipart/form-data&quot;</span><span class="p">,</span>
<a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a>            <span class="n">follow_redirects</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-79-26" name="__codelineno-79-26" href="#__codelineno-79-26"></a>        <span class="p">)</span>
<a id="__codelineno-79-27" name="__codelineno-79-27" href="#__codelineno-79-27"></a>        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
<a id="__codelineno-79-28" name="__codelineno-79-28" href="#__codelineno-79-28"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">as_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-79-29" name="__codelineno-79-29" href="#__codelineno-79-29"></a>        <span class="k">assert</span> <span class="s1">&#39;Load successful!&#39;</span> <span class="ow">in</span> <span class="n">html</span>
<a id="__codelineno-79-30" name="__codelineno-79-30" href="#__codelineno-79-30"></a>
<a id="__codelineno-79-31" name="__codelineno-79-31" href="#__codelineno-79-31"></a>        <span class="c1"># match flow count</span>
<a id="__codelineno-79-32" name="__codelineno-79-32" href="#__codelineno-79-32"></a>        <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-79-33" name="__codelineno-79-33" href="#__codelineno-79-33"></a><span class="s2">            select count(*) as flows</span>
<a id="__codelineno-79-34" name="__codelineno-79-34" href="#__codelineno-79-34"></a><span class="s2">            from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DATABASE&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SCHEMA&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">.[my_table]</span>
<a id="__codelineno-79-35" name="__codelineno-79-35" href="#__codelineno-79-35"></a><span class="s2">            &quot;&quot;&quot;</span>
<a id="__codelineno-79-36" name="__codelineno-79-36" href="#__codelineno-79-36"></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">db_conn</span><span class="o">.</span><span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<a id="__codelineno-79-37" name="__codelineno-79-37" href="#__codelineno-79-37"></a>        <span class="n">rows</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-79-38" name="__codelineno-79-38" href="#__codelineno-79-38"></a>        <span class="n">rows_count</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-79-39" name="__codelineno-79-39" href="#__codelineno-79-39"></a>        <span class="k">assert</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rows_count</span><span class="si">}</span><span class="s1"> records loaded&#39;</span> <span class="ow">in</span> <span class="n">html</span>
</code></pre></div>
<p><strong>Test Code Structure</strong></p>
<ul>
<li>create a test module (file) of same name as test subject with test_ prefixed. Eg, <code>test_foo.py</code></li>
<li>import <code>unittest</code> and other required packages</li>
<li>create classes and methods for testing.</li>
<li>
<p>in test_method</p>
<ul>
<li>call code from your app, set varibles or directly put code in assert</li>
<li><code>assert some-code</code> some-code can be anything that evaluates to True.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="kn">import</span> <span class="nn">unittest</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">User</span><span class="p">,</span> <span class="n">Engine</span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="k">class</span> <span class="nc">TestUserAdd</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a>    <span class="k">def</span> <span class="nf">test_works</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>        <span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>        <span class="k">assert</span> <span class="n">u</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="c1"># anything that evalueates to True</span>
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a>
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="k">class</span> <span class="nc">TestEngineWork</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a>    <span class="k">pass</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>
<p>For a <strong>Flask App</strong></p>
<ul>
<li><code>setUp</code> and <code>tearDown</code> methods are special that automatically invoked before and after each test case. This makes every test case run on clean slate. You can have different one in each class, or make a base class and import it in other classes.</li>
<li>request functions<ul>
<li><code>response = app.client.get('/', follow_redirects=True)</code> - use response same as you do in flask app</li>
<li><code>response = self.client.post('/auth/register', data={some_json}, follow_redirects=True)</code> - submit a form this way</li>
</ul>
</li>
</ul>
<ul>
<li>response methods<ul>
<li><code>html = response.get_data(as_text=True)</code></li>
<li><code>assert response.status_code == 200</code></li>
<li><code>assert response.request.path == '/auth/login' # redirected to login</code></li>
<li><code>response.json['token']</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="c1"># tests/test_base.py</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="kn">import</span> <span class="nn">unittest</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">current_app</span>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">create_app</span><span class="p">,</span> <span class="n">db</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="k">class</span> <span class="nc">TestWebApp</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">()</span>
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">appctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">()</span>
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">appctx</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a>        <span class="n">db</span><span class="o">.</span><span class="n">do_something</span><span class="p">()</span> <span class="c1"># you can call any method as well here</span>
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_something</span><span class="p">()</span> <span class="c1"># method in this class that has code to be executed before each test, like register</span>
<a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
<a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a>
<a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a>        <span class="n">db</span><span class="o">.</span><span class="n">drop_something</span><span class="p">()</span> <span class="c1"># again execute anything at end of test case</span>
<a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">appctx</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">appctx</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a>
<a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a>    <span class="k">def</span> <span class="nf">test_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-81-23" name="__codelineno-81-23" href="#__codelineno-81-23"></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-81-24" name="__codelineno-81-24" href="#__codelineno-81-24"></a>        <span class="k">assert</span> <span class="n">current_app</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span>
<a id="__codelineno-81-25" name="__codelineno-81-25" href="#__codelineno-81-25"></a>
<a id="__codelineno-81-26" name="__codelineno-81-26" href="#__codelineno-81-26"></a>    <span class="k">def</span> <span class="nf">test_home_page_redirect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-81-27" name="__codelineno-81-27" href="#__codelineno-81-27"></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-81-28" name="__codelineno-81-28" href="#__codelineno-81-28"></a>        <span class="n">slef</span><span class="o">.</span><span class="n">do_login</span><span class="p">()</span> <span class="c1"># funciton in this class that logs in to the app can be reused</span>
<a id="__codelineno-81-29" name="__codelineno-81-29" href="#__codelineno-81-29"></a>        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
<a id="__codelineno-81-30" name="__codelineno-81-30" href="#__codelineno-81-30"></a>        <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">path</span> <span class="o">==</span> <span class="s1">&#39;/auth/login&#39;</span>
</code></pre></div>
</li>
</ul>
<ul>
<li><strong>Do s</strong><ul>
<li>
<p>If a piece of code is difficult to test with test case, consider refactoring it. Eg, some code that is not in funciton and just prints as part of execution can't be called from test case, so make a function for it. Alos, you can wrap any global code in a function and call it. This also makes code <strong>only direct</strong> executable when file is ran, <strong>import doesn't</strong> execute it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a>    <span class="n">all_your_global_code</span><span class="p">()</span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a>    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>Links<ul>
<li><a href="https://blog.miguelgrinberg.com/post/how-to-write-unit-tests-in-python-part-3-web-applications">MG' Flask Web App Testing</a></li>
<li><a href="https://github.com/miguelgrinberg/python-testing/blob/main/life/test_life.py">MS's Testing code for Life Game</a></li>
<li><a href="https://stackoverflow.com/questions/27954702/unittest-vs-pytest">Stackoverflow why to use PyTest</a></li>
<li><a href="https://flask.palletsprojects.com/en/2.2.x/tutorial/tests/">Flask Docs - Pure Pytest</a></li>
<li><a href="https://realpython.com/python-web-applications-with-flask-part-iii/">RealPython - Flask testing</a> has a different package, so differs</li>
<li><a href="https://codethechange.stanford.edu/guides/guide_flask_unit_testing.html">Codethechange Stanford - Guides Guide_flask_unit_testing</a></li>
</ul>
</li>
</ul>
<h2 id="error-handling">Error Handling</h2>
<ul>
<li><strong>Try.. Except..</strong><ul>
<li>You can use <code>try except finally</code> block to handle errors that you think might occur. With requests, it is <strong>best</strong> to handle errors at <strong>last step</strong> , that is before making the response, because, if at any previous step an error has occured it will bubble up. In another scenario, use <code>try.. except</code> at the step where you have another option to do in case of error. Eg, handle error in view when you make a db call that is last function before returning response. Do not handle it in model or db connections unless you have another database to fall over to or another table to ping.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Email / Log error</strong><ul>
<li>Error can be emailed to admin automatically.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Error Templates</strong><ul>
<li>You can have templates for exceptions and errors so they don't go out to end users.</li>
<li>
<p>These templates only work, when <code>FLASK_ENV=production</code> and <code>FLASK_DEBUG=0</code> in your environment.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1"># blueprint handler</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="nd">@bp</span><span class="o">.</span><span class="n">app_errorhandler</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="k">def</span> <span class="nf">internal_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a>    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;errors/404.html&#39;</span><span class="p">),</span> <span class="mi">404</span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a>
<a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="c1"># app handler</span>
<a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="k">def</span> <span class="nf">internal_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
<a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a>    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;errors/500.html&#39;</span><span class="p">),</span> <span class="mi">500</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>Links<ul>
<li><a href="https://realpython.com/python-web-applications-with-flask-part-iii/#error-handling">RealPython Flask App Part III</a></li>
</ul>
</li>
</ul>
<h2 id="log-in-flask">Log in Flask</h2>
<ul>
<li>A standard Python logging component <code>logger</code> is available on the Flask object at <code>app.logger</code>.</li>
<li>404 is autologged by server, so skip.</li>
<li>request logs are autologged by proxy server, so skip.</li>
<li>Exceptions, 400 and 500 can be logged to look back in time.</li>
</ul>
<ul>
<li>Setup<ul>
<li>configure logger as early as possible</li>
<li>add path and log configs in <code>config.py</code> even before app is created. You can add logging config to any env config class. They are all called before app is created.</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="kn">import</span> <span class="nn">logging</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;some log&#39;</span><span class="p">)</span>
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a>
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="c1"># prj/config.py</span>
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="kn">import</span> <span class="nn">logging</span>
<a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>
<a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
<a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;[</span><span class="si">%(asctime)s</span><span class="s1">] - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(module)s</span><span class="s1"> -: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a>
<a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="c1"># prj/app/models.py</span>
<a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">current_app</span>
<a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a><span class="n">current_app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Some message&#39;</span><span class="p">)</span>
</code></pre></div>
<ul>
<li>
<p>Explore <a href="https://memgraph.com/blog/graph-web-application#:~:text=Docker%20fanboy%20alert-,1.%20Create%20a%20Flask%20server,-I%20included%20comments">here</a></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="k">def</span> <span class="nf">init_log</span><span class="p">():</span>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Logging enabled&quot;</span><span class="p">)</span>
<a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a>    <span class="c1"># Set the log level for werkzeug to WARNING because it will print out too much info otherwise</span>
<a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;werkzeug&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<p><strong>Links</strong></p>
<ul>
<li><a href="https://flask.palletsprojects.com/en/2.2.x/logging/#basic-configuration">FlaskDocs - Config Logger</a></li>
<li><a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-vii-unit-testing-legacy#:~:text=the%20console%20window.-,Logging%20to%20a%20file,-Receiving%20errors%20via">MG - Logging to a File Legacy</a></li>
<li><a href="https://realpython.com/python-web-applications-with-flask-part-iii/#logging">RealPython - Flask Part III - Logging</a>. Eg, shows to Log Errors, keep 7 days history.</li>
</ul>
<h2 id="cli-in-flask">CLI in Flask</h2>
<p><em>how to build CLI commands in flask</em></p>
<p><strong>Test - add a CLI command to run tests</strong></p>
<p>You can build a CLI command to run  tests automatically. Add following code to files where you build app, usually <code>app/__init__.py</code></p>
<div class="highlight"><span class="filename">CLI command for running tests</span><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="nd">@app</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Run the unit tests.&quot;&quot;&quot;</span>       <span class="c1"># help msg on cli</span>
<a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a>    <span class="kn">import</span> <span class="nn">unittest</span>
<a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a>    <span class="n">tests</span> <span class="o">=</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestLoader</span><span class="p">()</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="s1">&#39;tests&#39;</span><span class="p">)</span>
<a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tests</span><span class="p">)</span>
</code></pre></div>
<p>To run this CLI command do following and it will run all the rest cases.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>flask<span class="w"> </span>--app<span class="w"> </span>flasky.py<span class="w"> </span><span class="nb">test</span>
</code></pre></div>
<h2 id="jupyter-notebook-with-flask">Jupyter Notebook with Flask</h2>
<p>You can use Jupyter notebook with your flask app for <strong>rapid</strong> development and testing. Benefits:</p>
<ul>
<li>use your flask modules in notebook like models, db-connections etc.</li>
<li>quickly develop the logic required in model / service layer.</li>
</ul>
<p><strong>Ensure correct path</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="c1"># make cwd same as where app is</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s1">&#39;..&#39;</span><span class="p">))</span>
</code></pre></div>
<p>Lets say you are in <code>./dev/my.ipynb</code> and your flask app is in <code>./app/__init__.py</code>, then your notebook execution should be in <code>.</code> that is folder that has <code>app</code> so that notebook can import the <code>app</code> as a module.</p>
<p><strong>Import app and build context:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">create_app</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">()</span>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="n">app_context</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">()</span>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="n">app_context</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
</code></pre></div>
<p><strong>Import Flask App modules you want to work on</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="kn">import</span> <span class="nn">json</span>
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>
<a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="kn">import</span> <span class="nn">app.config</span> <span class="k">as</span> <span class="nn">config</span>
<a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="kn">from</span> <span class="nn">app.bp.user.model</span> <span class="kn">import</span> <span class="n">Users</span>
<a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="kn">from</span> <span class="nn">app.utils.db_conn</span> <span class="kn">import</span> <span class="n">get_sqlite_db</span><span class="p">,</span> <span class="n">get_postgres_db</span>
<a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a>
<a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="kn">from</span> <span class="nn">app.bp.postapi.services</span> <span class="kn">import</span> <span class="n">get_posts</span><span class="p">,</span> <span class="n">set_posts</span>
</code></pre></div>
<h2 id="security-flaws-checks">Security Flaws Checks</h2>
<p>You can use <code>bandit</code> package to check security flaws in app. It scans code and lets you know any possible security flaw.</p>
<p><strong>Install and Run</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="c1"># install the package</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>bandit
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="c1"># run on the app module</span>
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a>bandit<span class="w"> </span>-r<span class="w"> </span>app
</code></pre></div>
<p>The second command above, runs the checks on the whole app and lists the issues by severity and confidance.</p>
<p><strong>Links</strong></p>
<ul>
<li><a href="https://realpython.com/python-testing/#testing-for-security-flaws-in-your-application">Realpython - Python Testing</a></li>
</ul>
<h2 id="make-the-project-installable">Make the Project Installable</h2>
<ul>
<li>Makes the project distributable like a library, so people can do <code>pip install</code> and use it.</li>
<li>Deploying is same as installing any other library. like you deploy <code>mkdocs</code> by installing it.</li>
<li>
<p><code>setup.py</code> outside <code>app</code> is where we can define this.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">find_packages</span><span class="p">,</span> <span class="n">setup</span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="n">setup</span><span class="p">(</span>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a>    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;your-project-name&#39;</span><span class="p">,</span>
<a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a>    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.0.0&#39;</span><span class="p">,</span>
<a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a>    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
<a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a>    <span class="n">include_package_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a>    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a>        <span class="s1">&#39;flask&#39;</span><span class="p">,</span>
<a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a>    <span class="p">],</span>
<a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>also add <code>MAINFEST.in</code> to tell what other files to include in package. Eg, <code>some.sql</code> <code>static</code> or any other.</li>
<li><a href="../python-notes/#packaging---installable-packages">VY Stem - Packaging</a></li>
<li>more <a href="https://flask.palletsprojects.com/en/2.2.x/tutorial/install/#describe-the-project">here</a></li>
<li><a href="https://realpython.com/python-web-applications-with-flask-part-iii/#logging">RealPython Flask App part III</a></li>
</ul>
<h2 id="deployment-fundamentals">Deployment Fundamentals</h2>
<ul>
<li>WSGI or "Web Server Gateway Interface"<ul>
<li>is a protocol (calling convention) to forward requests from a web server (Apache or NGINX) to a backend Python web application or framework. Python then builds response which is passed back to the webserver which shares it to the requestor.</li>
<li>it sits between Web Server and Python App. <code>Client -&gt; Webserver -&gt; WSGI -&gt; Python</code></li>
<li>WSGI containers are Gunicorn, uWSGI. They invoke python callable object, such as a route in flask.</li>
<li>WSGI container is <strong>required</strong> to be <strong>installed</strong> in the <strong>project</strong> so that a web server can communicate to a WSGI container which further <strong>communicates</strong> to the <strong>Python</strong> application and provides the response back accordingly.</li>
</ul>
</li>
</ul>
<ul>
<li>Development Web Server<ul>
<li>most frameworks come with development web server which serves requests. but this needs to be replaced on PROD.</li>
</ul>
</li>
</ul>
<ul>
<li>Links<ul>
<li><a href="https://www.liquidweb.com/kb/what-is-wsgi/">What is WSGI</a></li>
</ul>
</li>
</ul>
<h2 id="deployment-windows-iis-server">Deployment - Windows IIS Server</h2>
<ul>
<li><code>HTTP -&gt; IIS -&gt; ISAPI -&gt; FastCGI -&gt; WSGI -&gt; (Python Flask Application)</code></li>
</ul>
<ul>
<li>IIS site will trigger a <code>wfastcgi.py</code> script and will use <code>web.config</code> file which calls module that has flask app (or creates using app factory).</li>
<li>WFastCGI is a Py package, and <code>wfastcgi.py</code> provides a bridge between IIS and Python using WSGI and FastCGI. It is same as mod_python is for Apache.</li>
<li>you can impersonate as a user in appPoolIdentity</li>
<li>you can disable anonymous auth and can keep only windows authenticated access to get remote user in request.</li>
</ul>
<ul>
<li>Links<ul>
<li><a href="https://medium.com/@dpralay07/deploy-a-python-flask-application-in-iis-server-and-run-on-machine-ip-address-ddb81df8edf3">Detailed deployment process on Medium</a></li>
</ul>
</li>
</ul>
<h2 id="deployment-pythonanywhere-flask">Deployment - PythonAnywhere Flask</h2>
<ul>
<li>
<p>WSGI configuration</p>
<ul>
<li>On your Web App Configuration page, open "WSGI configuration file", and ensure you add your project folder to code below.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="kn">import</span> <span class="nn">sys</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="c1"># add your project directory to the sys.path</span>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="n">project_home</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;/home/username/mysite&#39;</span>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="k">if</span> <span class="n">project_home</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
<a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">project_home</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
<a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a>
<a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="c1"># import flask app but need to call it &quot;application&quot; for WSGI to work</span>
<a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="kn">from</span> <span class="nn">flask_app</span> <span class="kn">import</span> <span class="n">app</span> <span class="k">as</span> <span class="n">application</span>  <span class="c1"># noqa</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>more <a href="https://flask.palletsprojects.com/en/2.2.x/tutorial/deploy/">here</a></li>
</ul>
<h2 id="static-site-with-flask-frozen">Static Site with Flask-Frozen</h2>
<ul>
<li>Static site can be generated and hosted on Netlify or GitHub pages.</li>
</ul>
<ul>
<li>link<ul>
<li><a href="https://testdriven.io/blog/static-site-flask-and-netlify/">td.io - Frozen</a></li>
</ul>
</li>
</ul>
<h2 id="access-localhost-flask-app-on-network">Access localhost flask app on Network</h2>
<ul>
<li>Suppose on an Ubuntu VM a flask app is running on localhost and you want to access it from you host machine that is Mac.</li>
</ul>
<ul>
<li>Run flask app with <code>app.run(host='0.0.0.0', debug=True)</code></li>
<li>This tells your operating system to listen on all public IPs.</li>
<li>then access <code>192.168.10.33:5000</code> from host machine.</li>
</ul>
<p>Now that our app is running we can add a database to this app. We will use FlaskSQLAlchemy package for this. Or Pandas.</p>
<h2 id="machine-learning-pandas-app-in-flask">Machine Learning Pandas App in Flask</h2>
<p>You can use Flask it with Pandas, Matplot and other ML libraries to make it easily usable for end users.</p>
<ul>
<li>Import all your libs in flask app that you have used in Jupyter NB.</li>
<li>Add code and functions to read data and perform tasks.</li>
<li>Flask routes are executed for each request, so keep data reads outside to read them once.</li>
<li><code>return render_template( 'search.html', data=df_result.to_html(classes='table table-striped table-hover')</code> - to_html makes html table that can be passed to html page.</li>
<li><code>{{ data|safe }}</code> - safe makes it as markup and browser renders it.</li>
</ul>
<p>Reference:</p>
<ul>
<li><a href="https://sarahleejane.github.io/learning/python/2015/08/09/simple-tables-in-webapps-using-flask-and-pandas-with-python.html">https://sarahleejane.github.io/learning/python/2015/08/09/simple-tables-in-webapps-using-flask-and-pandas-with-python.html</a></li>
</ul>
<h2 id="charts-graphs-visualization-in-flask">Charts Graphs Visualization in Flask</h2>
<ul>
<li>Requirements<ul>
<li>HTML5 instead of PNG</li>
<li>dynamic, shows info on hover</li>
<li>interactive, filters modify charts</li>
<li>dashboard, filters update multiple charts</li>
<li>streaming dataset</li>
<li>animation</li>
</ul>
</li>
</ul>
<ul>
<li>Plotly<ul>
<li>dynamic &amp; interactive charts</li>
<li>handle data and build-chart in view function, then send JSON to template, use JSON in JS.</li>
</ul>
</li>
</ul>
<ul>
<li>Plotly Express<ul>
<li><code>import plotly.express as px</code></li>
<li><code>fig = px.bar()</code> lets build bar</li>
<li><code>fig.show()</code> makes PNG</li>
</ul>
</li>
</ul>
<ul>
<li>Plotly Graph Objects<ul>
<li><code>import plotly.graph_objects as go</code> builds figure objects.</li>
<li>has class for object like <code>go.Bar()</code></li>
<li>objects need to be added to figure <code>fig = px.Figure()</code></li>
</ul>
</li>
</ul>
<ul>
<li>Bokeh<ul>
<li>beautiful charts, simple plot to complex dashboard with streaming dataset!</li>
<li>dynamic &amp; interactive</li>
<li><code>bokeh.plotting</code> has plotting functions</li>
<li><code>bokeh.models</code> has data handling functions</li>
<li><code>bokeh.embed</code> has component that return HTML with JS ready to embedd, when python <code>fig</code> is passed.</li>
</ul>
</li>
</ul>
<ul>
<li>Dash<ul>
<li>React front-end - yes</li>
<li>dashboard - yes</li>
<li>HTML in Python - NOooo</li>
<li><code>from dash import Dash, html, dcc</code><ul>
<li>Dash is app</li>
<li>html lets build html components <code>Div()</code> H1</li>
<li>dcc is Dash Core Components - lets build <code>Graph() Dropdown()</code>, graph has figues, from px.</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>Flask, Plotly &amp; AJAX<ul>
<li>Flask app and html template</li>
<li>use <code>json.dumps()</code> to get fig JSON and send to template</li>
<li>use list of <code>chartJSON[]</code> for sending multiple charts</li>
<li>template can use plotly js to plot chart with the json.</li>
<li>js <code>Plotly.plot('chart',graphs,{});</code> where <code>chart</code> is <code>id</code> of <code>div</code></li>
<li>to extend, send graphJSON, header, description</li>
<li>AJAX<ul>
<li><code>onchange=cb(this.value)</code> to invoke callback function, that passes value to python and python returns updated chartJSON</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>Data Handling<ul>
<li>mostly libraries use list, which has series from DataFrame</li>
<li>px takes in dataframe as <code>data</code></li>
</ul>
</li>
</ul>
<ul>
<li>Altair<ul>
<li>py library</li>
</ul>
</li>
</ul>
<ul>
<li>Chart.js<ul>
<li>No Python wrapper</li>
<li>is dynamic</li>
</ul>
</li>
</ul>
<ul>
<li>Highchart, google charts, d3.js ?</li>
</ul>
<ul>
<li>anychart<ul>
<li>can be drawn from JSON, JSON needs to build without python wrapper</li>
</ul>
</li>
</ul>
<ul>
<li>Matplot, ggplot<ul>
<li>static chart, save fig as png, return file from view_function</li>
</ul>
</li>
</ul>
<ul>
<li>Links<ul>
<li><a href="https://towardsdatascience.com/web-visualization-with-plotly-and-flask-3660abf9c946">TDS - Web Visualization with Plotly and Flask</a></li>
<li><a href="https://towardsdatascience.com/an-interactive-web-dashboard-with-plotly-and-flask-c365cdec5e3f">TSD - Flask plotly AJAX</a></li>
<li><a href="https://dash.plotly.com/layout">Dash offical</a></li>
</ul>
</li>
</ul>
<h2 id="restapi-in-flask">RestAPI in Flask</h2>
<p>What is REST?</p>
<ul>
<li>Client and Server are separate</li>
<li><strong>Stateless:</strong> No information from a request is stored on client to be used in other requests, eg, no session can be started, if authentication is required, username and password need to be sent with every request.</li>
</ul>
<p>What is RESTful API:</p>
<ul>
<li>There is a resource, eg, tasks</li>
<li>It has endpoints for CRUD operations</li>
<li>HTTP methods, GET PUT POST DELETE, are used for these operations.</li>
<li>Data is provided with these requests in no particular format but usually as:<ul>
<li>JSON blob in request body, or</li>
<li>Query String arguments as portion of URL.</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>URI</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><a href="http://hostname/todo/api/v1.0/tasks">http://hostname/todo/api/v1.0/tasks</a></td>
<td>Retrieve list of tasks</td>
</tr>
<tr>
<td>GET</td>
<td><a href="http://hostname/todo/api/v1.0/tasks/[task_id]">http://hostname/todo/api/v1.0/tasks/[task_id]</a></td>
<td>Retrieve a task</td>
</tr>
<tr>
<td>POST</td>
<td><a href="http://hostname/todo/api/v1.0/tasks">http://hostname/todo/api/v1.0/tasks</a></td>
<td>Create a new task</td>
</tr>
<tr>
<td>PUT</td>
<td><a href="http://hostname/todo/api/v1.0/tasks/[task_id]">http://hostname/todo/api/v1.0/tasks/[task_id]</a></td>
<td>Update an existing task</td>
</tr>
<tr>
<td>DELETE</td>
<td><a href="http://hostname/todo/api/v1.0/tasks/[task_id]">http://hostname/todo/api/v1.0/tasks/[task_id]</a></td>
<td>Delete a task</td>
</tr>
</tbody>
</table>
<p>Data of a task can be, JSON blob, as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="p">{</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>  <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Title of a to do task&#39;</span><span class="p">,</span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>  <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Description of to do task&#39;</span><span class="p">,</span> 
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>  <span class="s1">&#39;done&#39;</span><span class="p">:</span> <span class="kc">False</span>
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li>This API can be consumed by client side app which can be single page HTML.</li>
<li>Note, JSON object is defined in python as dict, <code>jonify</code> converts and send as JSON Object.</li>
</ul>
<h3 id="api-architecture">API Architecture</h3>
<p>API can have following modules:</p>
<ul>
<li><code>views.py</code> - handle requests and call required service, validates request params</li>
<li><code>service.py</code> - takes request param, calls database model, to do db crud and data processing, business logic implementation</li>
<li><code>model.py</code> - data orm and data structures</li>
<li><code>utils/api.py</code> - handles api key management</li>
<li><code>utils/db.py</code> - handles DB connections</li>
<li>JSON in and JSON out.</li>
</ul>
<p>Use <code>DataClasses</code> for API data structure and JSON conversions.</p>
<h2 id="jwt-authentication-in-flask">JWT Authentication in Flask</h2>
<ul>
<li>JWT Authentication<ul class="task-list">
<li><code>jwt</code> python library is used to make a <code>token</code> that can be send in every request instead of sending username and password.</li>
<li>Token is encoded string which has a valid time and it expires after that time.</li>
<li><code>ExpiredSignatureError</code> is raised if you <code>decode</code> and expired token string.</li>
<li class="task-list-item"><input type="checkbox"/> how to add remember me.</li>
</ul>
</li>
</ul>
<ul>
<li>how to register?<ul>
<li>comment <code>token_authentication</code> for <code>create_user</code></li>
<li><code>curl -i -X POST -H "Content-Type: application/json" -d '{"username":"admin","password":"admin"}' http://127.0.0.1:5000/admin</code></li>
</ul>
</li>
</ul>
<ul>
<li>CURL Requests<ul class="task-list">
<li>Send Username and password to get token<ul>
<li><code>curl -u username:password -i -X GET http://127.0.0.1:5000/login</code> returns token and duration</li>
</ul>
</li>
<li>Send token in header to access protected resources<ul>
<li><code>curl -H "x-access-token: token" -i -X GET http://127.0.0.1:5000/users</code></li>
<li><code>curl -H "x-access-token: token" -i -X GET http://127.0.0.1:5000/users/9d8c738b-3a39-482d-8a17-0c1b755f9a23</code></li>
<li><code>curl -H "x-access-token: token" -i -X GET http://127.0.0.1:5000/api/v1.0/tasks</code></li>
<li><code>curl -H "x-access-token: token" -i -X GET http://127.0.0.1:5000/api/v1.0/tasks/19</code></li>
</ul>
</li>
<li class="task-list-item"><input type="checkbox"/> will this be more secure and beneficial?<ul>
<li><code>curl -u username_or_token:password_or_unused -i -X GET http://127.0.0.1:5000/users</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="flask-snippets">Flask Snippets</h2>
<p><strong>URL Redirect to previous</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="k">def</span> <span class="nf">redirect_url</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">):</span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a>    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span> <span class="ow">or</span> \
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>           <span class="n">request</span><span class="o">.</span><span class="n">referrer</span> <span class="ow">or</span> \
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a>           <span class="n">url_for</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="c1"># Use it in in the view</span>
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="k">def</span> <span class="nf">some_view</span><span class="p">():</span>
<a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a>    <span class="c1"># some action</span>
<a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a>    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">redirect_url</span><span class="p">())</span>
</code></pre></div>
<h2 id="app-restful-api-in-flask">App - RESTful API in Flask</h2>
<p>to be added</p>
<h2 id="serving-over-https">Serving over HTTPS</h2>
<ul>
<li>generate certificate key using <code>openssl req -x509 -newkey rsa:4096 -nodes -out cert.pem -keyout key.pem -days 365</code></li>
<li>allow insecure connection to localhost in chrome, paste <code>chrome://flags/#allow-insecure-localhost</code></li>
<li><a href="https://blog.miguelgrinberg.com/post/running-your-flask-application-over-https">https://blog.miguelgrinberg.com/post/running-your-flask-application-over-https</a></li>
</ul>
<h2 id="app-social-blogging-app-in-flask">App - Social Blogging App in Flask</h2>
<ul>
<li>
<p><strong>User Authentication</strong></p>
<ul>
<li><strong>Password hashing</strong><ul>
<li>extensions - <code>from werkzeug.security import generate_password_hash, check_password_hash</code> this is tried and tested lib that is safe to use.</li>
<li>model - implement <code>password</code> as write-only property of <code>User</code> class to set <code>password_hash</code></li>
</ul>
</li>
</ul>
<ul>
<li><strong>Blueprint</strong> - structure it as a sub-module <code>auth</code> Blueprint. It has view having login-route</li>
</ul>
<ul>
<li>
<p><strong>Normal auth</strong></p>
<ul>
<li>Login - <code>session['user_id'] = user['id']</code> once credentials are verified, save <code>user_id</code> in <code>session</code> dictionary, it makes it available across requests for the session.<ul>
<li>
<p><code>g.User</code> can hold user object. Using Blueprints decorator <code>@bp.before_app_request</code> register a function that sets <code>g.user</code>. If there is no <code>user_id</code> in session, <code>g.User</code> will be <code>None</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="nd">@bp</span><span class="o">.</span><span class="n">before_app_request</span>
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="k">def</span> <span class="nf">load_logged_in_user</span><span class="p">():</span>
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>    <span class="n">user_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a>
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a>    <span class="k">if</span> <span class="n">user_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a>        <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a>        <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a>        <span class="s1">&#39;SELECT * FROM user WHERE id = ?&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,)</span>
<a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a>        <span class="p">)</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>Logout - <code>session.clear()</code></li>
</ul>
<ul>
<li>
<p>Login Required Decorator - lets you use <code>@login_required</code> on view function so the following code is run before view-route code.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="k">def</span> <span class="nf">login_required</span><span class="p">(</span><span class="n">view</span><span class="p">):</span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a>    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a>    <span class="k">def</span> <span class="nf">wrapped_view</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a>        <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a>            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;auth.login&#39;</span><span class="p">))</span>
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a>
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a>        <span class="k">return</span> <span class="n">view</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a>
<a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a>    <span class="k">return</span> <span class="n">wrapped_view</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<ul>
<li>
<p><strong>Flask-login</strong> is ext having functions and decorators that make authentication easy.</p>
<ul>
<li>model - few required class members can either be declared in <code>User</code> class or can be importe from <code>UserMixin</code> class of Flask-login.</li>
<li>
<p>initialize and instantiate extension with required conf</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="kn">from</span> <span class="nn">flask_login</span> <span class="kn">import</span> <span class="n">LoginManager</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="n">login_manager</span> <span class="o">=</span> <span class="n">LoginManager</span><span class="p">()</span>
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="n">login_manager</span><span class="o">.</span><span class="n">login_view</span> <span class="o">=</span> <span class="s1">&#39;auth.login&#39;</span>
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a>
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="k">def</span> <span class="nf">create_app</span><span class="p">(</span><span class="n">config_name</span><span class="p">):</span>
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a>  <span class="c1"># ...</span>
<a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a>  <span class="n">login_manager</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a>  <span class="c1"># ...</span>
</code></pre></div>
</li>
</ul>
<ul>
<li>
<p>model implement user_loader in <code>User</code> class</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">login_manager</span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a>
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="nd">@login_manager</span><span class="o">.</span><span class="n">user_loader</span>
<a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="k">def</span> <span class="nf">load_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a>  <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_id</span><span class="p">))</span>
</code></pre></div>
</li>
</ul>
<ul>
<li><code>login_required</code> decorator lets protect route.</li>
<li>Flask-Login’s <code>login_user()</code> logs user in once verified. It setts user session.</li>
<li><code>logout_user()</code> logs user out.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Register User</strong><ul>
<li>build a form class in new <code>auth/forms.py</code>, add unique email and username validator using <code>validate_</code> function</li>
<li>build a template that uses form <code>templates/auth/register.html</code></li>
<li>build a register route in <code>auth/views.py</code><ul>
<li>get - render form</li>
<li>post - validate and add user to db</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>account confirmations</strong><ul>
<li>use expiry token to validate email url.</li>
<li>model - add token generation and validation function.</li>
<li>view - send email on registration</li>
<li>view - <code>@auth.route('/confirm/&lt;token&gt;')</code></li>
</ul>
</li>
</ul>
<ul>
<li><strong>Links</strong><ul>
<li><a href="https://realpython.com/using-flask-login-for-user-management-with-flask/">RealPython Flask-Login</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><strong>Roles and Permissions</strong><ul>
<li>database implementation<ul>
<li>add <code>role</code> table</li>
<li>add <code>permission</code> column to role table as integer<ul>
<li>multiple permission can be binary numbers, 1,2,4,8,16</li>
<li>add them and subtract them to get unique number as total permission of user. 2+4=6</li>
<li>do bit wise and operation to match permission. 6&amp;2=2, 6&amp;4=4</li>
</ul>
</li>
</ul>
</li>
<li>add decorator function to make it easy to protect route to access only if permission is checked.</li>
</ul>
</li>
</ul>
<ul>
<li><strong>User Profiles</strong></li>
</ul>
<h2 id="app-mega-tutorial-by-mg">App - Mega Tutorial by MG</h2>
<p><em>This is understanding of a tutorial by Miguel Grinberg, we are learning to create a micro-blogging site using flask and other dependencies.</em></p>
<ul class="task-list">
<li class="task-list-item"><input type="checkbox"/> UserMixin?</li>
<li class="task-list-item"><input type="checkbox"/> Why we pass Classes as param to Class?</li>
</ul>
<h2 id="elastic-search-in-flask">Elastic Search in Flask</h2>
<ul>
<li>You can install elastic search by <code>brew install elasticsearch</code> on mac.</li>
<li>Access <code>http://localhost:9200</code> to view service JSON output.</li>
<li>Also, install in python <code>pip install elasticsearch</code></li>
<li>To have launched start elasticsearch now and restart at login: <code>brew services start elasticsearch</code></li>
<li>Or, if you don't want/need a background service you can just run: <code>elasticsearch</code></li>
</ul>
<h2 id="advanced-flask">Advanced Flask</h2>
<ul>
<li>
<p>Request Processing</p>
<ul>
<li>
<p>Following diagram show the cycle of request-response</p>
<pre class="mermaid"><code>graph LR
Request --&gt;|GET\n1| Web_Server
Web_Server --&gt; WSGI_Server
WSGI_Server --&gt;|Spawns\n2| Flask_App
Flask_App --&gt;|Pushes\n3| Application_Context
Flask_App --&gt;|Pushes| Request_Context
Application_Context --&gt;|current_app\n4| View_Function
Request_Context --&gt;|request| View_Function
subgraph Global
Application_Context
Request_Context
end
subgraph Worker
Flask_App --&gt; View_Function
end
View_Function --&gt;|5| Response</code></pre>
</li>
</ul>
<ul>
<li>Step 1 - Handle request<ul>
<li>Web_server - Apache &amp; NginX</li>
<li>WSGI_Server - Gunicorn, uWSGI, mod_wsgi</li>
</ul>
</li>
<li>Step 2 - Spawn a <strong>Worker</strong><ul>
<li>it can be a thread, process or coroutine.</li>
<li><strong>one worker</strong> handles <strong>one request</strong> at a time.</li>
<li>hence for multiple concurrent request multiple worker can be spawned.</li>
</ul>
</li>
<li>Step 3 - pushes context<ul>
<li>worker pushes context to global-stack as <code>context-local</code> which uses <code>thread-local</code> data, which means, a worker, which is one thread, has data specific to a thread and can be only accessed by worker that created it. So its global-memory but worker-unique data as <code>global LocalStack()</code>.</li>
</ul>
</li>
<li>Step 4 - local context, proxy<ul>
<li>this context data is basically an object, stored as stack data structure. To make it available in view-function it is not passed as a parameter, neither is imported as a global object, rather it is made available using proxy</li>
</ul>
</li>
<li>Step 5 - Clean Up<ul>
<li>req and app context are removed from stack</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li>Threading</li>
</ul>
<ul>
<li>Link<ul>
<li><a href="https://testdriven.io/blog/flask-contexts-advanced/#:~:text=The%20Flask%20app%20generates%20a,server%2C%20and%20a%20web%20application.">td.io - Request processing</a></li>
</ul>
</li>
</ul>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://flask.palletsprojects.com/en/latest/tutorial/">Official Flask Blogging Tutorial - Flaskr</a><ul>
<li>app factory, blueprint</li>
<li>Plane DB operations, no ORM SQLAlchemy</li>
</ul>
</li>
<li><a href="https://realpython.com/python-web-applications-with-flask-part-i/">RealPython Flask Tutorial - Part I</a></li>
<li><a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Flask Mega Tutorial I - Miguel Grinberg</a></li>
<li><a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world-legacy">Flask Mega Tutorial I Legacy - Miguel Grinberg</a><ul>
<li>no blueprint.</li>
</ul>
</li>
</ul>
<!-- taken from 
https://github.com/squidfunk/mkdocs-material/blob/master/src/partials/source-file.html -->



<hr />
<div class="md-source-file">
    <small>

        
            <span class="md-icon" title="Last Updated">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
            </span> 
            <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2025-01-12T02:07:49+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2025-01-12</span>
        
        

        
            <span class="md-icon" title="Written On">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
            </span>
            <span> May 2019 </span>
        
        
    </small>
</div>






                

    
    

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2024 Vaibhav Yadav
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://in.linkedin.com/in/iyadavvaibhav" target="_blank" rel="noopener" title="in.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/iYadavVaibhav/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/iYadavVaibhav/" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.kaggle.com/iyadavvaibhav/kernels" target="_blank" rel="noopener" title="www.kaggle.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M304.2 501.5 158.4 320.3 298.2 185c2.6-2.7 1.7-10.5-5.3-10.5h-69.2c-3.5 0-7 1.8-10.5 5.3L80.9 313.5V7.5q0-7.5-7.5-7.5H21.5Q14 0 14 7.5v497q0 7.5 7.5 7.5h51.9q7.5 0 7.5-7.5v-109l30.8-29.3 110.5 140.6c3 3.5 6.5 5.3 10.5 5.3h66.9q5.25 0 6-3z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://public.tableau.com/profile/iyadavvaibhav" target="_blank" rel="noopener" title="public.tableau.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.654.174v2.203H9.682v.58h1.972V5.16h.696V2.957h1.97v-.58h-1.97V.174h-.348zm6.03 2.262-.002 1.623v1.623h-2.957v.927h2.957v3.188h1.043l.011-1.582.02-1.576 1.465-.02 1.46-.01v-.927h-2.953V2.436h-.522zm-12.407.06v3.19H2.291v.925h2.986v3.19h.985V6.61h3.013v-.925H6.262V2.496H5.77zm6.086 5.27v3.593H8.06v1.188h3.304v3.596h1.28v-3.596h3.309v-1.188h-3.31V7.766h-.637zm9.721 1.55v2.221h-2.012v.811h2.012v2.261h.887v-2.261H24v-.811h-2.029v-2.22h-.422zm-19.111.131v2.174H0v.621h1.973v2.194h.667v-2.194h2v-.62H2.609V9.446h-.318zm15.709 4.516v3.254h-3.016v.927h3.016v3.217h1.072v-3.216h2.986v-.928h-2.986v-3.254h-.533zm-12.463.008v3.246H2.262v.928h2.957v3.189H6.32v-3.189h2.955v-.928H6.32V13.97h-.55zm6.316 4.578.002 1.103v1.1H9.566v.812h1.971v2.262h.928l.012-1.119.017-1.143h1.969v-.812h-2v-2.203h-.465z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.follow", "navigation.top", "search.highlight", "search.suggest", "content.action.edit", "content.action.view", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../assets/javascripts/extra.js"></script>
      
        <script src="../../assets/javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>